# Project TODO - 六神ノ間 (Six Oracle)

## Phase 1: Core Setup
- [x] Project initialization with web-db-user template
- [x] Database schema setup (users, chat_logs, subscriptions)
- [x] Migrate previous site assets (images, logos)

## Phase 2: Frontend
- [x] Landing page with Celestial Etherealism design
- [x] Oracle character cards with images from previous site
- [x] Pricing section (月額980円)
- [x] Terms, Privacy, Legal pages
- [x] Dashboard/Chat interface

## Phase 3: Backend Features
- [x] Gemini API integration for AI chat
- [x] Chat history storage
- [x] Daily usage limits (free: 3/day, premium: 100/day)

## Phase 4: Payment System
- [x] ~~Stripe integration~~ (Removed - using external payment provider)
- [x] External payment provider support (Telecom Credit/BPM)
- [x] Subscription management (月額980円)
- [x] Cancellation flow with retention modal

## Phase 5: Polish
- [x] Mobile responsiveness
- [x] Performance optimization
- [x] Final testing and deployment

## Bug Fixes
- [x] キャラクター紹介の情報を以前のサイトと一致させる
- [x] Fix character images - all 6 characters now display unique images
- [x] Fix icon mapping - Sakuya uses Calculator, Akari uses Lightbulb
- [x] Fix upgrade button - now triggers Stripe checkout correctly

## Operational Review
- [x] Verify payment completion triggers premium status correctly
- [x] Check usage limits implementation (free: 3/day, premium: 100/day)
- [x] Review cost protection against heavy users - Added rate limiting (10 seconds between requests)
- [x] Verify Manus credit dependency for LLM calls - Documented in OPERATIONAL_REVIEW.md

## Payment Method Display Updates
- [x] Update legal page payment method to include debit/prepaid cards
- [x] Add prepaid card note to pricing section

## Contact Form Integration
- [x] Add contact form link to footer
- [x] Update legal page contact information with form link

## Legal Page Wording Update
- [x] Update 運営責任者・所在地・電話番号・メールアドレス to comply with 省略の特例

## Apple Pay / Google Pay Integration
- [x] Update legal page payment method to include Apple Pay / Google Pay
- [x] Update pricing section payment note to include Apple Pay / Google Pay
- [x] Enable Apple Pay / Google Pay in Stripe checkout

## Subscription Management Page
- [x] Create backend API for subscription status and payment history
- [x] Create subscription management page UI
- [x] Add navigation link to subscription page

## Mobile Navigation
- [x] Create mobile navigation component with hamburger menu
- [x] Integrate mobile navigation into Dashboard page
- [x] Integrate mobile navigation into Subscription page

## Profile Editing Feature
- [x] Create backend API for profile management (get/update)
- [x] Create profile page UI with edit form
- [x] Add navigation link to profile page

## Chat History Persistence
- [x] Add chat history table to database schema
- [x] Create API endpoints for saving and retrieving chat history
- [x] Update chat component to save messages to database

## Personalized Fortune-telling
- [x] Integrate user profile data (zodiac, birthdate) into chat prompts
- [x] Pass profile context to LLM for more accurate readings

## Chat History Viewing
- [x] Create chat history page to view past sessions
- [x] Add navigation link to history page

## Site Publication Preparation
- [x] Final review of all pages and functionality
- [x] Ensure all tests pass

## Stripe API Key Verification
- [x] Verify Stripe keys are properly configured
- [ ] Test payment flow with test card (user action required)

## Email Notification System
- [x] Create email notification service using Manus notification API
- [x] Add payment confirmation email
- [x] Add subscription renewal reminder email
- [x] Add welcome email for new subscribers
- [x] Add notification API endpoints for frontend

## Site Publication
- [x] Final review and testing
- [x] Prepare for publish

## Payment Test Guide
- [x] Create payment test page with instructions
- [x] Add test card information display

## Site Publication Preparation
- [x] Create pre-publication checklist
- [x] Verify all pages and functionality

## In-App Notification Banner
- [x] Create notification banner component
- [x] Integrate notification banner into dashboard
- [x] Display welcome and payment notifications

## Stripe Payment Test
- [x] Add payment test guide to subscription page
- [x] Display test card information

## Site Publication
- [x] Final pre-publication review
- [x] Prepare for publish button

## SEO Optimization
- [x] Add meta tags to index.html
- [x] Add OGP (Open Graph Protocol) tags
- [x] Create sitemap.xml
- [x] Add robots.txt
- [x] Add favicon and apple-touch-icon
- [x] Add JSON-LD structured data

## Image Lazy Loading
- [x] Add lazy loading to Home page images (oracle cards, footer logo)
- [x] Add lazy loading to Dashboard logo
- [x] Add lazy loading to ManusDialog component
- [x] Hero logo uses eager loading for above-the-fold content

## Profile Image Preview
- [x] Add profile image upload with instant preview
- [x] Add backend API for profile image storage to S3
- [x] Update profile page UI with image upload

## Pricing Update
- [x] Remove 4980 yen pricing reference from the website

## 通知機能の実装
- [x] アプリ内通知システム（DB・API・UI）
- [x] 新占い師追加のお知らせ機能
- [x] 週間運勢メール配信機能
- [x] プッシュ通知機能（不要と判断）
- [x] LINE連携機能（不要と判断）

## 多言語対応（グローバル展開）
- [x] 占い師を多言語対応に設定（海外ユーザー対応）
  - サーバー側の占い師プロンプトを多言語対応に更新
  - ユーザーの入力言語を自動検出し、その言語で応答
  - 対応言語：日本語、英語、中国語、韓国語、スペイン語、フランス語、ドイツ語、その他

## 海外ユーザー向け問い合わせ対応
- [x] 多言語対応の問い合わせフォームを作成
  - 日本語/英語切り替えボタン付き
  - カテゴリ選択（一般、支払い、サブスク、技術、フィードバック、その他）
  - /contact ルートでアクセス可能
- [x] 多言語FAQページを作成（日本語・英語）
  - アコーディオン形式のインタラクティブFAQ
  - 10項目のよくある質問（サービス、料金、占い師、データ保護等）
  - /faq ルートでアクセス可能
- [x] 問い合わせメッセージの自動翻訳機能を実装
  - 英語で入力されたメッセージを自動で日本語に翻訳
  - データベースに原文と翻訳文の両方を保存
  - オーナーに通知を送信

## 問い合わせ管理・返信機能
- [x] 管理者用問い合わせ一覧ページを作成 (/admin/inquiries)
- [x] 問い合わせ詳細・返信画面を作成
  - ステータス管理（新規、対応中、解決済み、クローズ）
  - 返信履歴表示
- [x] 返信の自動翻訳機能を実装（日本語→英語）
  - 英語ユーザーへの返信は自動で英訳
  - 原文と翻訳文の両方を保存
- [x] 返信通知機能を実装
  - 返信送信時にオーナーに通知

## グローバル多言語対応
- [x] 多言語システムの基盤を作成（翻訳データ、コンテキスト）
  - 対応言語：日本語、英語、中国語（簡体字）、韓国語、スペイン語、フランス語
  - LanguageContextとLanguageSwitcherコンポーネントを作成
  - 全ページ共通の翻訳データをtranslations.tsに集約
- [x] ブラウザ言語自動検出機能を実装
  - navigator.languageから初期言語を自動設定
  - localStorageに言語設定を保存
- [x] ランディングページを多言語対応に更新
  - ヒーローセクション、占い師紹介、料金、FAQ、フッターを多言語化
  - 右上に言語切り替えボタンを設置
- [x] FAQページを多言語対応に拡張（6言語）
- [x] 問い合わせフォームを多言語対応に拡張（6言語）
  - フォームラベル、カテゴリ、メッセージを全言語対応
  - サーバー側も全言語の問い合わせを受付可能に

## バグ修正
- [x] 占い師の翻訳データを正しい設定に修正（架空の占い師になっている問題）
  - 蒼真、玖蘭、朔夜、灯、結衣、玄の6人の正しい設定に修正
  - FAQの占い師紹介も正しい内容に更新

## 特商法ページ修正
- [x] 運営責任者・所在地・電話番号・メールアドレスの表示を修正
  - 「※請求があり次第提供致しますので、必要な方は本サイトのお問い合わせフォームよりご連絡ください。」に統一
  - 外部Googleフォームへのリンクをサイト内の/contactページに変更

## 意見箱（レビュー機能）
- [x] データベーススキーマに意見箱テーブルを追加
- [x] 意見箱APIを実装（投稿・一覧・自動翻訳）
- [x] 意見箱ページを作成（多言語対応）
- [x] 悪質書き込みへの警告文を追加（強制退会・法的処置の警告）
- [x] 管理者用の意見箱管理ページを作成

## 意見箱フォーム修正
- [x] ログイン確認を削除し、即座に投稿フォームを表示
- [x] ログインループの問題を解消
- [x] 多言語対応と自動翻訳機能を確認

## 意見箱投稿者情報の記録
- [x] データベースにIPアドレス・ユーザーエージェント等のフィールドを追加
- [x] APIを修正して投稿者情報を記録
- [x] 管理者画面で投稿者情報を表示（運営側のみ閲覧可能）

## 悪質ユーザーブロック機能
- [x] ブロックリストテーブルをデータベースに追加
- [x] ブロック追加・解除のAPIを実装
- [x] 投稿時にブロックチェックを追加
- [x] 管理者画面にブロック管理UIを追加

## フィードバック返信機能
- [x] 返信テーブルをデータベースに追加
- [x] 返信送信・取得のAPIを実装
- [x] 管理者画面に返信UIを追加
- [x] 返信の自動翻訳機能を実装

## フィードバック統計ダッシュボード
- [x] 統計データ取得のAPIを実装
- [x] カテゴリ別・評価別の集計グラフを作成
- [x] 管理者画面に統計ダッシュボードを追加

## 意見箱の修正（公開設定）
- [x] ユーザー向けフォームから「公開する」チェックボックスを削除
- [x] 公開の判断は管理者のみが行えるようにする
- [x] 公開された意見が正しく表示されるように修正

## フィードバック完全削除機能
- [x] 管理者専用のフィードバック削除APIを追加
- [x] 管理者画面に削除ボタンを追加
- [x] ユーザーに気づかれない形で削除（通知なし）

## 管理者画面の隠蔽
- [x] 管理者画面のアクセス制限をオーナー専用に変更
- [x] 管理者メニューへのリンクを完全に隠す（一般ユーザーには見えないように）
- [x] URLを直接入力してもオーナー以外はアクセス不可に

## ダッシュボード管理者メニュー
- [x] ダッシュボードにオーナー専用の管理者メニューを追加
- [x] 意見箱管理・問い合わせ管理へのリンクを表示（オーナーのみ）

## ダッシュボードUI改善
- [x] ハンバーガーメニューの表示問題を修正（モバイル表示時のみ表示される仕様）
- [x] サイドバーにユーザーID確認表示を追加（オーナー確認用）

## ログインエラー修正
- [ ] ログイン後にエラーが発生してTOPに戻る問題を調査
- [ ] エラーを修正

## 管理者画面切り替え機能
- [x] 管理者専用ページ（/admin）を作成
- [x] ダッシュボードと管理画面の切り替えボタンを追加（オーナーのみ表示）
- [x] 管理画面からダッシュボードへ戻るボタンを追加

## カスタムドメインOAuth回避策
- [x] ランディングページのログインボタンを旧ドメインにリダイレクト
- [x] 「今すぐ申し込む」ボタンを旧ドメインにリダイレクト
- [x] フッターのログインリンクを旧ドメインにリダイレクト（フッターにログインリンクなし）
- [x] 動作確認とチェックポイント保存

## FAQ追加：ドメイン変更の説明
- [x] FAQページに「ログイン後にURLが変わる理由」の説明を追加
- [x] 多言語対応（日本語・英語・中国語・韓国語・スペイン語・フランス語）

## ランディングページにFAQリンク追加
- [x] ランディングページにFAQへのリンクを追加
- [x] ドメイン変更についての注意書きを追加

## SNS共有ボタン追加
- [x] SNS共有コンポーネントを作成（Twitter/X、LINE、Facebook）
- [x] 占い結果ページにSNS共有ボタンを組み込み
- [x] 共有テキストの多言語対応（6言語）

## 占い結果の画像化機能
- [x] 占い結果を画像として生成する機能を実装
- [x] 画像ダウンロードボタンを追加
- [x] SNS共有時に画像を添付できるようにする（Web Share API対応）

## 紹介キャンペーン機能
- [x] 紹介コード生成機能を実装
- [x] 紹介コード入力機能を実装
- [x] 紹介成功時の無料鑑定回数付与機能を実装
- [x] 紹介状況確認ページを作成（/referral）

## 無料プラン制限変更（1日3回→累計5回）
- [x] データベーススキーマに累計使用回数フィールドを追加
- [x] 無料プランの制限ロジックを「1日3回」から「累計5回」に変更
- [x] 紹介キャンペーン成功時に追加回数を付与する機能を実装
- [x] UIに残り回数表示を追加
- [x] 回数が0になったら有料プランへの案内を表示
- [x] 多言語対応（エラーメッセージ日本語対応）

## BPM審査対応（決済代行会社変更）
- [x] Terms.tsxのStripe表記を「クレジットカード決済」に修正
- [x] Privacy.tsxのStripe表記を「決済代行会社」に修正（2箇所）
- [x] Legal.tsxの特定商取引法表記を実際の情報に更新（運営責任者・所在地・電話番号・メールアドレス）
- [x] 全ページでStripe表記がないか最終確認（フロントエンドは完了、サーバー側はBPM導入後に置換予定）

## チャット機能改善（LINE風連続送信対応）
- [x] Dashboard.tsxで占い師切り替え時にメッセージをクリアしないように修正
- [x] セッションIDを保持して同じ占い師との会話を継続できるようにする
- [x] 会話履歴をLLMに渡して文脈を維持する

## ダッシュボード遷移問題の修正
- [ ] ログイン後にダッシュボードに遷移しない問題を調査
- [ ] Safari等の様々なブラウザで動作するように修正
- [ ] 動作確認とテスト

## OAuthリダイレクトURIエラーの修正
- [ ] 「許可が拒否されました - リダイレクトURIが設定されていません」エラーを修正
- [ ] ログインボタンを修正してダッシュボードに遷移できるようにする

## LINE風チャットUI改善
- [x] 返答後も入力欄を表示したままにする
- [x] 占い師を切り替えずに連続でメッセージを送れるようにする
- [x] 画像保存・シェア機能をメッセージの下にコンパクトに表示

## ログイン問題の修正（再発）
- [ ] ログインできない問題を調査
- [ ] 原因を特定して修正

## 404エラーの修正
- [ ] OAuthコールバック後に404エラーが発生する問題を修正
- [ ] /dashboardへのルーティングを確認・修正

## ログイン後リダイレクトとアクセス制限の修正
- [x] 一般ユーザーはログイン後に占いダッシュボード（/dashboard）に遷移
- [x] 管理者は管理画面（/admin）にもアクセス可能
- [x] 管理者画面は運営側（admin role）のみアクセス可能に制限
- [x] 課金後に占い画面に遷移するように修正

## セキュリティ強化
- [x] ダッシュボードの認証チェックを強化（未ログインユーザーはアクセス不可）
- [x] 管理者画面のアクセス制限を強化（role='admin'以外は404ページを表示）
- [x] 課金フローの強制（無料回数を使い切ったらアップグレードボタン表示）
- [x] URLを直接入力してもセキュリティが保たれるようにする

## ユーザーデータ分離とプライバシー保護の確認
- [x] 鑑定履歴が各ユーザーごとに正しく分離されているか確認
- [x] 他のユーザーの鑑定結果を見られないようになっているか確認
- [x] APIエンドポイントで適切なユーザー認証チェックがされているか確認

## 管理者画面とユーザー画面の完全分離
- [x] 管理者画面にユーザー管理機能を追加（ユーザー一覧、編集、削除）
- [x] 全ユーザーはログイン後に占いダッシュボードに遷移
- [x] 管理者のみダッシュボードから管理画面にアクセス可能
- [x] 鑑定履歴は本人のものだけ表示されることを確認済み

## 無料プランと有料プランの表示切り替え
- [x] 無料プランの制限を明確に表示（累計5回まで）
- [x] 有料プランへの導線を強化（アップグレードボタン、プラン比較）
- [x] ダッシュボードでプラン状態を表示（無料/有料）
- [x] 無料回数が0になったら有料プランへの案内を表示

## 占い師キャラクターの個性強化
- [x] 蒼真：時間・運命の流れに関する詳細な占術説明を追加
- [x] 玲蘭：恋愛・癒しに特化した共感的な回答フォーマットを追加
- [x] 朔夜：数秘術の具体的な数字の意味・計算を含む回答を追加
- [x] 灯：タロットカードの具体的なカード名と意味を含む回答を追加
- [x] 結衣：夢占いの象徴・シンボル解釈を含む回答を追加
- [x] 玄：具体的な行動指針・ステップを含む回答フォーマットを追加
- [x] 各キャラクター固有の決め台詞・キャッチフレーズを追加
- [x] 占い結果の構成フォーマットを差別化

## 無料プランの鑑定画面
- [x] 無料プランユーザー向けの鑑定画面UIを作成
- [x] 残り無料回数の表示
- [x] 無料回数が0になった時のアップグレード案内
- [x] 有料プランとの違いを明確に表示

## ログイン問題の修正
- [ ] ログインフローの調査
- [ ] OAuth設定の確認
- [ ] 問題の修正

## 決済機能の一時無効化
- [x] アップグレードボタンを「準備中」表示に変更
- [x] 決済ページへの遷移を無効化
- [x] ユーザーへの案内メッセージを追加

## 管理者による手動プレミアム化機能
- [x] 管理者画面にユーザー一覧を表示
- [x] ユーザーのプレミアムステータスを切り替える機能
- [x] プレミアム期間の設定機能

## 招待コード/クーポン機能
- [x] クーポンコードのデータベーステーブル作成
- [x] クーポン管理画面（管理者用）
- [x] クーポン入力画面（ユーザー用）
- [x] クーポン適用でプレミアム化する処理

## メールアドレス + パスワード認証
- [x] データベーススキーマを更新（パスワードハッシュ、メール確認トークン、リセットトークン）
- [x] 新規登録API（メールアドレス、パスワード）
- [x] ログインAPI（メールアドレス、パスワード）
- [x] メール確認API（トークン検証）
- [x] パスワードリセットAPI（リセットリンク送信、新パスワード設定）
- [x] 新規登録フォーム（フロントエンド）
- [x] ログインフォーム（フロントエンド）
- [x] パスワードリセットフォーム（フロントエンド）
- [x] 確認メール自動送信（自動確認に変更）
- [x] リセットメール自動送信（管理者通知で代替）

## ログインページの修正
- [x] /loginページがManus OAuthにリダイレクトされる問題を修正
- [x] メールアドレス認証フォームが正しく表示されるようにする
- [x] 新規登録後にダッシュボードに正しく遷移するようにする
- [x] メール/パスワードログイン後にManus OAuthにリダイレクトされるバグを修正（sdk.tsで両方の認証方式をサポート）

## ログインマニュアルの作成
- [x] ユーザー向けログインマニュアルを作成
- [x] 新規登録手順
- [x] ログイン手順
- [x] パスワードリセット手順

## ヘルプページの作成
- [x] ヘルプページを作成（/help）
- [x] ログインマニュアルをヘルプページに組み込む
- [x] ナビゲーションにヘルプページへのリンクを追加
- [x] 多言語対応

## ヘルプ機能の拡充
- [x] ダッシュボード内にヘルプリンクを追加（サイドバー）
- [x] スクリーンショット付きチュートリアルを作成
- [x] チャットサポート機能を実装

## オンボーディングツアー機能
- [x] オンボーディングツアーコンポーネントを作成
- [x] ダッシュボードにツアーを統合
- [x] 初回ログイン検出とツアー起動ロジックを実装
- [x] ツアーの多言語対応
- [x] ツアー完了状態の保存

## ログインフローの詳細説明
- [x] Manusアカウントログイン後のアカウント選択画面の説明を追加
- [x] 各ステップの詳細な操作説明を追加
- [x] スクリーンショットを追加して視覚的にわかりやすく
- [x] 初心者向けの注意点やヒントを追加

## プレミアムプランアップグレード手順
- [x] ヘルプページにアップグレード手順セクションを追加
- [x] 決済フローの詳細説明を追加
- [x] 多言語対応（6言語）

## Stripe説明の削除
- [x] ヘルプページからプレミアムプランアップグレード手順セクションを削除

## ヘルプページのセキュリティ改善とパスワード統一
- [x] スクリーンショットのメールアドレスを伏せる（goldrizing@gmail.com → example@email.com）
- [x] Manusアカウントの説明を追加（別のアカウントを使用する場合の手順）
- [x] パスワード要件を12桁に統一（新規登録画面）

## スクリーンショット画像のメールアドレス伏せ処理
- [x] アカウント選択画面のスクリーンショットのメールアドレス部分をモザイク処理
- [x] 処理した画像をpublicフォルダに配置

## ログイン不具合の修正（メール認証後にManus画面に遷移する問題）
- [ ] メールアドレス/パスワードログイン後にManusアカウント選択画面に遷移する不具合を調査
- [ ] ログイン処理のフローを修正
- [ ] 動作確認

## 無料プラン変更と鑑定履歴非表示
- [x] 無料プランの累計回数を5回から20回に変更
- [x] 鑑定履歴ページを非表示にする（ナビゲーションから削除）

## 無料プラン50回変更と紹介機能の改善
- [x] 無料プランの累計回数を20回から50回に変更
- [x] プレミアムプランのみ鑑定履歴を表示できるようにする（無料プランは不可）
- [x] 紹介ページへのリンクを作成（サイドバーとモバイルナビに追加）
- [x] チャット画面のアップグレード画面に紹介ページボタンを追加（タップしやすいUI）
- [x] 紹介コード入力で累計回数を40回まで回復できる機能を追加
- [x] 紹介者には3回ボーナスを付与

## 紹介キャンペーン説明とFAQ、プレミアム機能強化
- [x] 紹介ページの説明を日本語で分かりやすく更新（6言語対応）
- [x] 紹介キャンペーンと無料プランのFAQを作成（5つの質問と回答）
- [x] 無料プランを「初回お試しキャンペーン」として表示を更新（累計50回まで）
- [x] プレミアムプランの特典を追加（鑑定履歴閲覧、より深い鑑定機能）
- [x] ダッシュボードとアップグレード画面の表示を更新

## 無料プラン説明と紹介コード回復回数の修正
- [x] 紹介コードの回復回数を30回から40回に変更（再変更）
- [x] ヘルプページの無料プラン説明を累計50回に更新
- [x] FAQの無料プラン説明を累計50回に更新
- [x] 紹介ページの説明を40回回復に更新
- [x] プレミアムプランの説明を「本格的な鑑定ができる」に更新
- [x] 鑑定履歴はプレミアム限定（無料プランでは履歴なし、アップグレード時に引き継ぎ）の説明を追加

## ホームページ料金プラン説明の修正
- [x] 無料プランの説明を「累計5回」から「累計50回」に変更
- [x] 無料プランに「紹介コード入力で累計40回まで回復＆鑑定履歴表示」の説明を追加
- [x] プレミアムプランに「鑑定履歴を引き継ぎ」と「本格的な深い鑑定機能」の説明を追加
- [x] 紹介コードの回復回数を30回から40回に変更（サーバー、翻訳ファイル、FAQ）

## 紹介コードロジック変更とプレミアムプラン新機能
- [x] 紹介コード入力で紹介者（紹介した人）が30回回復するように変更（紹介された人ではなく）
- [x] 紹介された人の回復は削除（紹介コード入力は紹介者への特典のみ）
- [x] プレミアムプランに「新しい占い師も占える機能」の説明を追加（毎月3人追加予定）
- [ ] 将来のプラン説明を追加（9人以上でプラン引き上げ、最大月2000円まで）
- [x] ホームページ、紹介ページ、FAQの説明を更新
- [x] 紹介ページのヘッダー説明文を更新（紹介者が30回回復に変更）

## FAQ修正
- [x] 「料金はいくらですか？」の回答を修正（無料プランは累計50回に変更）

## 管理者専用画面の追加
- [x] 管理者専用ページの基盤を作成（/admin ルート、認証ガード）
- [x] ユーザー一覧・管理機能を実装
- [x] 売上・統計ダッシュボードを実装
- [ ] 占い師の追加・編集機能を実装
- [x] お問い合わせ・フィードバック管理を実装
- [x] クーポンコード管理を実装
- [x] サイドバーに管理者メニューを追加（admin権限のみ表示）

## 管理者専用秘密URL
- [x] 管理者専用の秘密URLを作成（認証不要で直接アクセス可能）
- [x] 推測されにくいURLパスを設定

## リッチな鑑定履歴機能
- [ ] 鑑定履歴のデータベーススキーマを確認・更新（要約フィールド追加）
- [ ] 鑑定履歴一覧ページを作成（占い師アイコン、キャラ口調の要約表示）
- [ ] 鑑定履歴詳細ページを作成（全文ログ、シェア機能）
- [ ] プラン格差を実装（無料:5件、プレミアム:全履歴）
- [ ] デザインをリッチに（魔法陣・星空背景、スクリーンショット映え）
- [ ] AIによる「鑑定のまとめ」自動生成機能

## リッチな鑑定履歴機能
- [x] 鑑定履歴のデータベーススキーマを更新（summary, characterQuote, isCompleteフィールド追加）
- [x] 鑑定履歴一覧ページを作成（占い師アイコン、要約表示）
- [x] 鑑定履歴詳細ページを作成（全文ログ、シェア機能）
- [x] プラン格差を実装（無料:5件、プレミアム:全履歴）
- [x] デザインをリッチに（魔法陣・星空背景）
- [x] サイドバーに鑑定履歴リンクを追加
- [ ] AIによる「鑑定のまとめ」自動生成機能を実装

## 特定商取引法に基づく表記の確認・修正（審査対策）
- [x] 現在の法的ページを確認
- [x] 運営者名、連絡先の記載を確認
- [x] 支払い時期と方法の記載を確認
- [x] 解約・退会方法の記載を確認（サブスク必須）→ 具体的な手順を追加
- [x] サービスの提供時期の記載を確認
- [x] 無料プランの説明を「累計50回まで」に修正


## 決済システム変更（Stripe → テレコムクレジット/BPM対応）

- [x] Stripe関連コードの削除
  - server/stripe/フォルダ削除
  - routers.tsからStripe import削除
  - package.jsonからstripe依存関係削除
- [x] テレコムクレジット用の決済フロー設計・実装
  - EXTERNAL_PAYMENT_URL環境変数で決済URLを設定可能
  - subscription.getPaymentUrl APIを追加
- [x] 決済完了後のリダイレクト処理実装（パラメータ付きURL対応）
  - /api/payment/callbackエンドポイントを追加
  - user_idパラメータでユーザーをプレミアム化
- [x] 解約リンク・管理機能の簡素化
  - EXTERNAL_CANCELLATION_URL環境変数で解約URLを設定可能
  - 解約フィードバックはDBに保存
- [x] 課金ページのUI更新（外部決済リンク方式に変更）
  - Subscription.tsxを外部決済対応に書き換え
  - Dashboard.tsxのアップグレードボタンを外部決済対応に更新
- [x] テスト・動作確認
  - TypeScriptエラーなし
  - サーバー正常起動


## 新占い師追加（第7人目：手相占い「紫苑」）

- [x] 新占い師のキャラクター設定・説明文を作成
- [x] アイコン画像を生成
- [x] oracles.tsに新占い師を追加
- [x] サーバー側のプロンプト設定を追加
- [x] 無料プランは1人のみ選択可能、プレミアムは全員選択可能に制限を実装
- [x] テスト・動作確認（全テスト71件パス）
- [x] クレジットコストを確認・報告


## 無料プラン制限の基本方針変更

- [x] oracles.tsで既存6人と追加占い師を区別するフラグ（isCore）を追加
- [x] サーバー側の制限ロジックを変更（既存6人は常に利用可能、追加占い師は1人のみ選択可）
- [x] Dashboard.tsxのUIを更新（既存6人はロックなし、追加占い師のみ制限表示）
- [x] MobileNav.tsxのUIを更新
- [x] テスト・動作確認（全テスト71件パス）


## ホームページ占い師紹介セクション更新

- [x] Home.tsxの占い師紹介セクションに紫苑を追加
  - translations.tsに紫苑の翻訳を追加（6言語対応）
  - セクションタイトルを「導き手たち」に変更（人数を限定しない表現に）
- [x] 動作確認（ブラウザで紫苑が表示されることを確認）


## 第8人目の占い師追加・プラン差別化・Bot対策

### 第8人目の占い師
- [ ] 新しい占術を選定（星座占い、風水、オーラ占いなど）
- [ ] キャラクター設定・説明文を作成
- [ ] アイコン画像を生成
- [ ] oracles.ts、translations.tsに追加
- [ ] サーバー側のプロンプト設定を追加

### ヒーローセクション更新
- [ ] キャッチコピーを人数を限定しない表現に変更

### プレミアムプラン差別化
- [ ] スタンダードプラン: 980円/月 - 100回/日（毎日リセット）
- [ ] プレミアムプラン: 1,980円/月 - 無制限（今後値上げなしの豪華プラン）
- [ ] DBスキーマにプランタイプを追加
- [ ] 利用回数カウント・リセット機能を実装
- [ ] ダウングレード機能を実装
- [ ] 解約機能を実装

### Bot対策
- [ ] 不自然な返信パターンを自動検知
- [ ] 短時間での大量リクエスト検知
- [ ] 制限・警告機能を実装

### ランニングコスト計算
- [ ] LLM APIコストの見積もり
- [ ] プラン別の収益性計算


## 決済システム変更（Stripe → テレコムクレジット/BPM対応）

- [x] Stripe関連コードの削除
  - server/stripe/フォルダ削除
  - routers.tsからStripe import削除
  - package.jsonからstripe依存関係削除
- [x] テレコムクレジット用の決済フロー設計・実装
  - EXTERNAL_PAYMENT_URL環境変数で決済URLを設定可能
  - subscription.getPaymentUrl APIを追加
- [x] 決済完了後のリダイレクト処理実装（パラメータ付きURL対応）
  - /api/payment/callbackエンドポイントを追加
  - user_idパラメータでユーザーをプレミアム化
- [x] 解約リンク・管理機能の簡素化
  - EXTERNAL_CANCELLATION_URL環境変数で解約URLを設定可能
  - 解約フィードバックはDBに保存
- [x] 課金ページのUI更新（外部決済リンク方式に変更）
  - Subscription.tsxを外部決済対応に書き換え
  - Dashboard.tsxのアップグレードボタンを外部決済対応に更新
- [x] テスト・動作確認

## 新占い師追加（第7人目：手相占い「紫苑」）

- [x] 新占い師のキャラクター設定・説明文を作成
- [x] アイコン画像を生成
- [x] oracles.tsに新占い師を追加
- [x] サーバー側のプロンプト設定を追加
- [x] 無料プランは1人のみ選択可能、プレミアムは全員選択可能に制限を実装
- [x] テスト・動作確認（全テスト71件パス）

## 無料プラン制限の基本方針変更

- [x] oracles.tsで既存6人と追加占い師を区別するフラグ（isCore）を追加
- [x] サーバー側の制限ロジックを変更（既存6人は常に利用可能、追加占い師は1人のみ選択可）
- [x] Dashboard.tsxのUIを更新（既存6人はロックなし、追加占い師のみ制限表示）
- [x] MobileNav.tsxのUIを更新
- [x] テスト・動作確認（全テスト71件パス）

## ホームページ占い師紹介セクション更新

- [x] Home.tsxの占い師紹介セクションに紫苑を追加
  - translations.tsに紫苑の翻訳を追加（6言語対応）
  - セクションタイトルを「導き手たち」に変更（人数を限定しない表現に）
- [x] 動作確認（ブラウザで紫苑が表示されることを確認）

## 第8人目の占い師追加・プラン差別化・Bot対策

- [x] 第8人目の占い師を追加（星座占い「星蘭」）
- [x] ヒーローセクションのキャッチコピーを更新（人数を限定しない表現に）
- [x] プレミアムプランの差別化（980円/15回日、2980円/50回日）
- [x] ダウングレード・解約機能の実装
- [x] Bot対策（不自然な返信パターン検知・制限）
- [x] ランニングコスト計算（黒字確保の価格設定）
- [x] テスト・動作確認（全テスト71件パス）


## 追加課金（100円/10回）・紹介プログラム改善

- [ ] データベーススキーマに追加課金関連フィールドを追加
  - purchasedReadings（追加購入した回数）
- [ ] サーバー側API実装
  - 追加課金API（100円/10回）- 外部決済URL生成
  - 追加課金コールバックAPI（回数付与）
- [ ] フロントエンドUI実装
  - 追加課金ボタン（100円/10回）
  - 残り回数表示の更新
- [ ] 紹介プログラムの調整
  - 紹介者: 5回付与
  - 被紹介者: 5回ボーナス
  - 紹介上限: 月10人まで
- [ ] テスト・動作確認


## 追加課金（100円/10回）・紹介プログラム実装
- [x] データベーススキーマに紹介・追加課金関連フィールドを追加
- [x] サーバー側API実装（追加課金、紹介プログラム）
- [x] フロントエンドUI実装（Subscription.tsx更新）
- [x] テスト・動作確認（全テスト71件パス）


## 手相占い師「紫苑」専用画像送信機能

- [x] 画像アップロード・S3保存APIを実装（chat.uploadPalmImage）
- [x] 不適切画像検出機能を実装（Gemini Vision APIで手以外の画像、陰部等をブロック）
- [x] フロントエンドUI実装（紫苑専用のカメラアイコンボタン、プレビュー、ヒントテキスト）
- [x] 手相画像をLLMに送信して鑑定する機能を実装
- [x] テスト・動作確認（75件パス）


## 手相鑑定機能の改善

- [x] 紫苑のプロンプトに手相の線の解釈ガイドを追加（生命線、感情線、頭脳線、運命線、太陽線、財運線、結婚線、特殊印等）
- [x] 画像アップロードのガイダンス追加（明るい場所、手のひらを開く、利き手の説明）
- [x] 鑑定履歴に手相画像を保存する機能を実装（DBスキーマ更新、履歴ページで画像表示）
- [x] テスト・動作確認（79件パス）


## 追加占い師の課金システム

- [x] データベーススキーマに追加占い師購入フィールドを追加（purchasedOracleIds）
- [x] 無料プランで1人目の追加占い師は無料で選択可能
- [x] 2人目以降の追加占い師は100円で購入可能（purchaseOracle API）
- [x] 購入済み占い師の管理API実装（getSelectedOracle, addPurchasedOracle）
- [x] フロントエンドUI実装（無料/¥100バッジ、購入済み表示）
- [x] テスト・動作確認（79件パス）


## 課金設計の調整（利益最大化）

- [x] 無料鑑定回数を50回から30回に変更
- [x] 追加占い師の価格を¥100から¥300に変更
- [x] 回数回復機能を実装（¥300で累計30回に回復）
- [x] UIに回数回復ボタンを追加
- [x] テスト・動作確認（79件パス）


## プラン表記の更新

- [x] 無料プランの表記を更新（累計30回、追加占い師1人無料、¥300で回数回復）
- [x] プレミアムプランの表記を更新
- [x] ダッシュボードの表示を更新（Subscription.tsx）
- [x] ホームページのプラン比較セクションを更新
- [x] ヘルプページの説明を更新
- [x] 特定商取引法ページの価格表記を更新

## テレコムクレジット連携調査

- [x] テレコムクレジットのサービス内容を調査
- [x] 連携可能性についてまとめ（telecom-credit-research.md）


## 残り回数アラートと初回限定キャンペーン

- [x] 残り回数アラート機能を実装（残り5回以下でポップアップ表示）
- [x] 初回限定キャンペーン機能を実装（初回回数回復¥200）
- [x] DBスキーマに初回購入フラグを追加（hasUsedFirstRecoveryDiscount）
- [x] UIに初回限定価格を表示（ピンク色で強調）
- [x] テスト・動作確認（79件パス）


## 回数残り0時のブロック画面とサンクスページ

- [x] 回数残り0時の専用ブロック画面を実装（鑑定画面をブロック）
- [x] 回数回復またはプレミアム加入を促すモーダル表示
- [x] 購入完了後のサンクスページを実装（紙吹雪アニメーション付き）
- [x] サンクスページから鑑定画面へのナビゲーション
- [x] 各決済URLにサンクスページへのリダイレクトを追加
- [x] テスト・動作確認（79件パス）


## 購入履歴ページと通知機能

- [x] 購入履歴テーブルをDBスキーマに追加（purchaseHistory）
- [x] 購入履歴APIを実装（getHistory, recordPurchase, getSummary）
- [x] 購入履歴ページのUIを実装（/purchase-history）
- [x] 残り回数が少ない時のアプリ内通知を実装（残り5回以下で1日1回）
- [x] 残り回数が少ない時のメール通知を実装（オーナーへの通知）
- [x] テスト・動作確認（79件パス）


## 購入履歴のPDFエクスポート機能

- [x] PDF生成APIをサーバー側に実装（CSV形式でダウンロード可能）
- [x] 購入履歴ページにCSVダウンロードボタンを追加
- [x] CSVに発行日、お客様名、購入明細、合計金額を含める
- [x] テスト・動作確認（79件パス）


## 管理者画面へのアクセスを秘密トークンで完全分離

- [ ] 秘密トークンを生成して環境変数に設定
- [ ] /admin?token=XXX でのみ管理者画面にアクセス可能に
- [ ] 一般ユーザーは占い画面のみにアクセス（管理者画面をブロック）
- [ ] オーナーは秘密トークンで管理者画面と占い画面を自由に行き来可能
- [ ] テスト・動作確認


## 管理者画面へのアクセスを秘密トークンで完全分離
- [x] 秘密トークンを生成して環境変数に設定
- [x] /admin?token=XXX でのみ管理者画面にアクセス可能に
- [x] 一般ユーザーは占い画面のみにアクセス（管理者画面をブロック）
- [x] オーナーは秘密トークンで管理者画面と占い画面を自由に行き来可能
- [x] テスト・動作確認


## UI配色の統一と料金プラン黒字化
- [ ] ユーザー画面（ダッシュボード等）を青系に統一
- [ ] 管理者画面を赤系に統一
- [ ] 無料プランを累計30回に変更
- [ ] 料金プラン比較を見直し（黒字化）
- [ ] 回数回復課金設定はそのまま維持


## UI配色の統一と料金プラン黒字化
- [x] ユーザー画面（ダッシュボード等）を青系に統一
- [x] 管理者画面を赤系に統一
- [x] 無料プランを累計30回に変更
- [x] 料金プランを3プラン構成に変更（無料、スタンダード980円/15回日、プレミアム2980円/50回日）
- [x] 回数回復課金設定はそのまま維持


## サイドバー（メニュー選択画面）の色分け
- [x] ユーザー画面のサイドバーを青系に変更
- [x] 管理者画面のサイドバーを赤系に変更


## ボード（背景・カード）の色分け
- [x] 管理者画面のボードを赤系に変更（文字は白）
- [x] ユーザー画面のボードを青系に変更（文字は白）


## 管理画面の文字色統一
- [x] 管理画面の赤文字を白に変更


## 管理画面アクセス問題の修正
- [ ] 管理画面の編集画面（意見箱管理、問い合わせ管理等）へのアクセス問題を修正

## テレコムクレジットAPI連携
- [ ] テレコムクレジットのAPI連携について調査


## 管理画面リンクのトークン引き継ぎ修正
- [ ] Admin.tsxのリンクにトークンパラメータを追加
- [ ] 各サブページの「ダッシュボードに戻る」リンクにもトークンを追加


## 管理画面リンクのトークン引き継ぎ修正
- [x] Admin.tsxのリンクにトークンパラメータを追加
- [x] AdminFeedback.tsxの戻るリンクにトークンを追加
- [x] AdminInquiries.tsxの戻るリンクにトークンを追加
- [x] AdminUsers.tsxの戻るリンクにトークンを追加
- [x] AdminCoupons.tsxの戻るリンクにトークンを追加
- [x] AdminStats.tsxの戻るリンクとクイックリンクにトークンを追加


## プラン別日次制限と回復機能
- [x] プレミアムプラン：1日50回、翌朝リセット
- [x] スタンダードプラン：1日15回、翌朝リセット
- [x] スタンダードプラン向け¥50回復機能
- [x] UIに残り回数表示と回復ボタンを追加
- [x] FAQと料金説明を更新


## スタンダードプラン回復課金の変更（¥50→¥100）
- [x] サーバー側の回復課金ロジックを¥100に変更
- [x] フロントエンドのUI表記を¥100に変更
- [x] FAQの料金説明を¥100に更新（6言語）
- [x] その他関連する表記を確認・修正


## 無料プラン廃止と新体験フローへの変更
- [x] 無料プランを廃止（累計30回の無料鑑定を削除）
- [x] 冒頭2～3往復のみ無料体験→有料誘導の仕組みを実装
- [x] トップページに「的中体験」セクションを追加（鑑定実績・結果のチラ見せ）
- [x] プラン選択画面から無料プランカードを削除
- [x] プラン文言を「全占い師による無制限・本格鑑定」に変更
- [x] チャット画面で無料体験後に有料誘導モーダルを表示
- [x] 特定商取引法に基づく表記を新料金体系に更新
- [x] プライバシーポリシーを新料金体系に更新
- [x] 利用規約を新料金体系に更新
- [x] 管理画面を新プラン構成に対応
- [x] FAQと翻訳データを更新（6言語）


## トライアルプランで全占い師を利用可能に
- [x] トライアルユーザーの占い師制限を解除（全8人利用可能に）
- [x] 関連するUIの表示を確認・修正


## チャットサポートボタンの位置修正
- [x] ダッシュボード（チャット画面）からサポートボタンを削除
- [x] ヘルプページのみにサポートボタンを表示


## ダッシュボードにヘルプリンクを追加
- [x] サイドバーの「ヘルプ」メニューにサポートチャットへの誘導を追加
- [x] ヘルプページにサポートチャットボタンがあることを明示


## チャット画面ログイン問題の修正
- [ ] ログインできない問題を調査
- [ ] 問題を修正


## トライアルユーザー向け鑑定プロトコルの実装
- [x] サーバー側：トライアルユーザーの往復数をカウントし、3往復目で本格鑑定モード誘導
- [x] 占い師プロンプト：トライアルモード用の指示を追加（2往復は聞き取り、3往復目で誘導）
- [x] フロントエンド：プラン選択モーダルに決済リンクとプラン説明を追加
- [x] 決済リンクA（スタンダード）とB（プレミアム）の設定


## 占い師が他の占い師を紹介する機能
- [x] 占い師プロンプトに他の占い師紹介ルールを追加（断定回避、不安を煎らない、選択の主体性をユーザーに置く）
- [x] 免責事項をプロンプトに追加
- [x] 「他の意見も聞きたい」トリガーに対応


## 紹介履歴の追跡とおすすめ占い師機能
- [ ] 紹介履歴追跡用のデータベーステーブルを作成
- [ ] サーバー側に紹介履歴記録APIを追加
- [ ] おすすめ占い師提案アルゴリズムを実装（相談内容に基づく）
- [ ] フロントエンドにおすすめ占い師表示を追加
- [ ] 管理画面に回遊パターン分析を追加

## 紹介追跡システムとおすすめ占い師機能
- [x] データベーススキーマの追加（oracle_referrals, user_consultation_topics）
- [x] おすすめ占い師取得APIの実装（getRecommendedOracles）
- [x] 紹介フォロー追跡APIの実装（markReferralFollowed）
- [x] ダッシュボードにおすすめ占い師セクションを追加
- [x] チャット送信時のトピック分析機能を実装
- [x] 占い師間の紹介検出・記録機能を実装
- [x] 管理画面に紹介分析ダッシュボードを追加（/admin/referral-analytics）
- [x] 紹介追跡システムのテストを作成・実行

## 音声入力機能（Whisper API）
- [x] 音声録音・変換のバックエンドAPIを実装
- [x] チャット画面にマイクボタンと録音UIを追加
- [x] 録音した音声をWhisper APIで高精度変換
- [x] 変換されたテキストを入力欄に反映
- [x] テストの作成と実行

## 音声機能の拡張
- [x] 音声読み上げ機能（Text-to-Speech）を実装
- [x] 録音履歴機能を実装
- [x] リアルタイム文字起こしプレビューを実装
- [x] テストの作成と実行

## 占い師ごとの音声設定
- [x] 占い師ごとの音声設定データを定義（ピッチ、速度、声質）
- [x] TextToSpeechコンポーネントを拡張して占い師設定を反映
- [x] Dashboardで占い師の音声設定を適用
- [x] テストの作成と実行

## シンプルモード（高齢者・初心者向け）
- [x] シンプルモードのUI設計（大きなボタン、シンプルな画面）
- [x] シンプルモード専用ページを作成
- [x] 音声操作と自動読み上げ機能を統合
- [x] ホーム画面からシンプルモードへのアクセスを追加
- [x] テストの作成と実行

## 音声ガイダンスチュートリアル
- [x] 音声チュートリアルコンポーネントを作成
- [x] シンプルモードにチュートリアルを統合
- [x] 初回利用時のみ自動表示する仕組みを実装
- [x] テストの作成と実行

## 文字サイズ調整機能
- [x] 文字サイズコンテキストとフックを作成
- [x] シンプルモードに文字サイズ切り替えUIを追加
- [x] 設定をlocalStorageに保存

## お気に入り占い師機能
- [x] お気に入り占い師の保存・取得機能を実装
- [x] シンプルモードにお気に入りボタンを追加
- [x] お気に入り占い師をワンタップで呼び出せるUIを追加

## 読み上げ音量調整機能
- [x] 音量調整コンテキストとフックを作成
- [x] 音量切り替えUIコンポーネントを作成
- [x] シンプルモードに音量調整UIを統合
- [x] 設定をlocalStorageに保存
- [x] テストの作成と実行

## 読み上げ速度の自動調整
- [x] 聞き取りやすい速度（0.75倍速）をデフォルトに設定
- [x] 占い師のキャラクターに合わせた微調整を維持
- [x] シンプルモードに適用
- [x] テストの作成と実行

## ハイコントラストモード
- [x] ハイコントラストモードのコンテキストとフックを作成
- [x] 配色切り替えUIコンポーネントを作成
- [x] シンプルモードにハイコントラストUIを統合
- [x] 設定をlocalStorageに保存
- [x] テストの作成と実行

## 利用履歴の簡易表示
- [x] 過去の相談履歴を取得するAPIを作成
- [x] 大きな文字で履歴を表示するコンポーネントを作成
- [x] シンプルモードに履歴表示ボタンを追加
- [x] テストの作成と実行

## 音声ガイダンスの多言語対応
- [x] 英語・中国語のガイダンステキストを追加
- [x] 言語切り替え機能を実装
- [x] 音声読み上げの言語を自動切り替え
- [x] テストの作成と実行

## 占い師音声設定の修正
- [x] 蒼真の読み方を「あおしん」から「そうま」に修正
- [x] キャラクター性別に合わせた音声パラメータを調整（男性は低い声、女性は高い声）
- [x] シンプルモードの音声読み上げにキャラクター設定を適用
- [x] テストの作成と実行

## 音声の感情表現強化
- [x] 占い結果の感情分析機能を実装（ポジティブ/ネガティブ/中立/神秘的/警告）
- [x] 感情に応じた読み上げパラメータの動的調整（速度・ピッチ・音量）
- [x] ダッシュボードとシンプルモードに適用
- [x] テストの作成と実行（16テストケース追加）

## BGM機能
- [x] 神秘的なBGM音源をWeb Audio APIで生成（3種類：神秘的/穏やか/宇宙的）
- [x] BGMのオン/オフ切り替え機能
- [x] 音量調整機能
- [x] ダッシュボードとシンプルモードにBGMコントロールを追加
- [x] 設定のlocalStorage保存

## 占い師ごとの専用BGM
- [x] 各占い師のキャラクターに合わせたBGM設定を定義
  - 蒼真：時の流れを感じる荘厳なサウンド
  - 玖蘭：優しく温かい癒しのサウンド
  - 朔夜：神秘的で数秘術的なサウンド
  - 灯：神秘的でタロット的なサウンド
  - 結衣：夢幻的で柔らかいサウンド
  - 玄：力強く安定感のあるサウンド
  - 紫苑：スピリチュアルで霊的なサウンド
  - 星蘭：宇宙的で広がりのあるサウンド
- [x] BGMコンテキストを拡張して占い師別BGMをサポート
- [x] 占い師選択時に自動でBGMを切り替え
- [x] ダッシュボードとシンプルモードに統合
- [x] テストの実行（350テスト全てパス）

## プラン構成のシンプル化（プレミアム¥1,980統一）
- [x] スタンダードプラン（¥980）を廃止
- [x] プレミアムプランを¥2,980→¥1,980に変更
- [x] 無料ユーザーの機能制限を強化
  - [x] 音声通話モード：プレミアム限定
  - [x] 画像鑑定（手相）：プレミアム限定
  - [x] BGM機能：全ユーザー利用可（体験向上のため）
  - [x] 深層鑑定：プレミアム限定（無料は簡易版）
  - [x] 鑑定履歴：プレミアムのみ永久保存
- [x] 料金ページのUIをシンプルに更新（2プラン→1プラン表示）
- [x] ダウングレードオプションを削除（プランが1つのため）
- [x] お試し→有料への導線は維持（各占い師3回まで）

## 料金情報の統一（¥1,980）
- [x] 利用規約の料金情報を¥1,980に更新
- [x] プライバシーポリシーの料金情報を¥1,980に更新（料金記載なし）
- [x] 特定商取引法に基づく表記を¥1,980に更新
- [x] FAQの料金関連質問を¥1,980に更新（6言語対応）
- [x] 全ての旧料金（¥980、¥2,980）の記載を削除

## 銀行振込対応と特商法・免責事項の強化
- [x] 特商法ページに銀行振込関連の記載を追加
  - [x] 支払方法：「銀行振込」を追記
  - [x] 支払時期：「前払い（振込確認後にサービス提供）」と記載
  - [x] 商品代金以外の必要料金：「振込手数料はお客様負担」と明記
- [x] 利用規約に占いサービスの免責事項を目立つ位置に追加
  - [x] 「本サービスは娯楽を目的としたものであり、将来の出来事を確約するものではありません」
- [x] 無料お試しを完全廃止（課金必須化）
  - [x] ダッシュボードへのアクセスは課金後のみ
  - [x] 特商法・料金ページから無料体験の記載を削除
  - [x] FAQから無料体験関連の記載を削除
- [x] 銀行振込決済フローと合言葉発行システムを構築
  - [x] 銀行振込先情報の表示ページ
  - [x] 合言葉発行・管理機能（管理者側）
  - [x] 合言葉入力によるプレミアム有効化機能（ユーザー側）

## 振込確認メール通知機能
- [x] 振込申請時にユーザーへ確認メールを送信
  - [x] 振込先口座情報を含むメール
  - [x] 申請受付の確認メッセージ
- [x] 合言葉発行時にユーザーへメールを送信
  - [x] 合言葉（アクティベーションコード）を含むメール
  - [x] プレミアムプランの有効化手順を含むメール
- [x] メールテンプレートの作成（アプリ内通知形式）

## 管理者向け振込申請一覧ページ・プラン改善
- [x] 銀行振込先情報を楽天銀行に更新
  - [x] 楽天銀行エンカ支店 普通 1479015 タケベケイサク
  - [x] routers.tsの振込先情報を更新
  - [x] email.tsの振込先情報を更新
- [x] 特商表記・FAQ等の銀行情報を更新
  - [x] Legal.tsx（特商表記）の銀行情報を更新
  - [x] translations.tsのFAQ銀行情報を更新
- [x] 管理者向け振込申請一覧ページを作成
  - [x] 未処理の振込申請を一覧表示
  - [x] ワンクリックで合言葉を発行
  - [x] 申請ステータスの管理（承認/却下）
- [x] 1ヶ月使い放題プランと継続確認機能
  - [x] premiumExpiresAtフィールドを追加
  - [x] 1ヶ月経過後に自動でプレミアム解除
  - [x] 継続確認リマインダー（有効期限3日前）
  - [x] 継続する場合は再度振込申請フロー
- [x] 鑑定履歴の永久保存・引き継ぎ機能
  - [x] 解約しても鑑定履歴を保持（データは削除しない）
  - [x] 再開時に過去の履歴を引き継ぎ（同じユーザーID）

## 継続確認メール通知と年間プラン
- [ ] 継続確認メール通知機能
  - [ ] 有効期限3日前にユーザーへ継続確認メールを自動送信
  - [ ] メール内容：有効期限、継続方法、振込先情報
  - [ ] 通知システムを活用した配信
- [ ] 年間プラン（¥19,800）の追加
  - [ ] 年間プランの料金設定（¥19,800 = 2ヶ月分お得）
  - [ ] 年間プラン用の振込申請フロー
  - [ ] 年間プラン用の有効期限設定（12ヶ月）
  - [ ] 料金ページ・特商表記・FAQの更新


## 年間プラン（¥19,800/年）の追加
- [x] データベーススキーマにplanTypeフィールドを追加（bankTransferRequests）
- [x] 銀行振込申請APIにplanTypeパラメータを追加
- [x] 管理者画面にプランタイプ表示を追加
- [x] 通知メールにプラン情報を追加
- [x] Home.tsxのPricingセクションに年間プランを追加
- [x] Legal.tsx（特商法）に年間プラン料金情報を追加
- [x] Terms.tsx（利用規約）に年間プラン料金情報を追加
- [x] FAQ翻訳データに年間プラン情報を追加


## 年間プラン振込確認フローとプラン比較表
- [x] 年間プラン振込確認時に有効期間を365日に設定するロジックを追加
- [x] ランディングページにプラン比較表を追加（月額/年間の機能比較）


## 年間プラン返金不可表記の追加
- [x] 特商法ページに年間プラン返金不可の表記を追加
- [x] FAQに年間プラン返金不可の表記を追加（6言語対応）
- [x] 1ヶ月お試し用の合言葉を発行


## 合言葉入力でプレミアム有効化フローの改善
- [x] 「プレミアムプラン準備中」表示の削除
- [x] プレミアムプラン選択時に合言葉入力フォームを表示
- [x] 合言葉送信でプレミアム有効化・鑑定開始のフロー実装


## 合言葉管理と管理者画面の一元管理化
- [x] 合言葉の月額/年間プラン区分け管理（毎月変更対応）
- [x] 管理者画面の一元管理化（振込申請・合言葉発行・ユーザー管理を統合ダッシュボードに）
- [x] 振込申請時の管理者通知機能の強化（新規申請通知）


## 管理者画面に合言葉発行ボタンを追加
- [x] 管理者画面に合言葉発行セクションを追加
- [x] 月額プラン用の合言葉発行ボタン（30日間有効）
- [x] 年間プラン用の合言葉発行ボタン（365日間有効）


## 合言葉管理機能の拡張
- [x] 発行済み合言葉一覧画面の実装（検索・使用状況確認）
- [x] 合言葉の有効期限通知機能の実装（管理者への通知）
- [x] 毎月の合言葉自動生成機能の実装


## 振込確認後の合言葉自動メール送信機能
- [x] 振込確認時に合言葉を自動生成してユーザーにメール送信
- [x] メールに合言葉の使用方法と有効期限を記載


## 通常単発鑑定とプレミアムプランの比較表
- [x] ランディングページに通常鑑定vsプレミアムプランの比較表を追加
- [x] お得感を訴求する視覚的なデザイン（節約額、回数無制限などを強調）


## 鑑定画面のバグ修正
- [x] 鑑定画面のバグを調査
- [x] バグの原因を特定し修正（useStateの位置をコンポーネント先頭に移動）


## 簡単モード時の音声ノイズ問題修正
- [ ] 簡単モードの音声処理を調査
- [ ] ノイズの原因を特定し修正


## 簡単モード時の音声ノイズ問題修正
- [x] 簡単モードの音声処理を調査
- [x] ノイズの原因を特定し修正（ローパスフィルター追加、周波数整理、音量調整）


## 簡単モードのキャラクター拡張と通常モード音声入力
- [x] 簡単モードで全6人の占い師キャラクターを選択可能に変更
- [x] 通常モードに音声入力機能を追加（既に実装済み - VoiceInputコンポーネント）


## 簡易ログインシステム（Manus OAuth → メール/パスワード認証）
- [x] Manus OAuthを削除し、メール/パスワード認証に変更
- [x] ログインページをシンプルなメール/パスワード形式に更新
- [x] 新規登録機能を実装
- [x] 管理者によるユーザー作成機能を実装
- [x] 管理者によるパスワードリセット機能を実装
- [x] const.tsのgetLoginUrl()を/loginに変更


## 解約機能の表示更新
- [x] 解約後に「解約しました」と表示
- [x] 「来月までは使えます」というメッセージを表示


## 解約機能の強化
- [x] 解約理由のアンケートフォームを追加
- [x] 解約撤回機能（「解約を取り消す」ボタン）を追加
- [x] 解約前の確認ダイアログを改善（残り期間・特典表示）


## 電話番号認証（SMS認証）ログイン
- [ ] データベーススキーマに電話番号と認証コードを追加
- [ ] SMS送信APIの実装
- [ ] 電話番号でのログイン/登録ロジックを実装
- [ ] 電話番号ログインUIを作成


## 電話番号認証（SMS認証）ログイン
- [x] データベーススキーマに電話番号と認証コードを追加
- [x] SMS送信API（デモモード）の実装
- [x] 電話番号でのログイン/登録ロジックを実装
- [x] 電話番号ログインUIを作成
- [x] 認証コードの画面表示（デモモード）
- [x] ログイン後のダッシュボード遷移確認


## 電話番号認証の機能強化
- [x] 国コード選択機能を追加（日本、アメリカ、中国、韓国など主要国）
- [x] 認証コードの再送信制限を実装（回数制限、クールダウン時間）


## ログイン履歴の記録機能
- [ ] データベーススキーマにログイン履歴テーブルを追加
- [ ] ログイン時に履歴を記録するロジックを実装（IPアドレス、デバイス情報）
- [ ] ユーザー向けログイン履歴表示UIを作成
- [ ] 不審なログインの検知・通知機能


## ログイン履歴の記録機能
- [x] データベーススキーマにログイン履歴テーブルを追加
- [x] ログイン時に履歴を記録するロジックを実装（IPアドレス、デバイス情報）
- [x] ユーザー向けログイン履歴表示UIを作成（/login-history）
- [x] 不審なログインの検知機能


## 電話番号ログインの修正
- [x] 電話番号ログイン後の無料体験3回を削除（無料回数を付与しない）
- [x] 認証番号がログイン後も表示されるバグを修正


## 電話番号認証ログインの問題修正
- [x] ログインボタンを押しても1発でログインできない問題を修正
- [x] verifyOtpで電話番号が既に正規化されている場合の処理を修正


## 電話番号認証の追加修正
- [x] 認証コード回数制限を削除（1日5回制限を解除）
- [x] コード入力後に画面が切り替わらない問題を修正


## 電話番号認証の1発遷移修正
- [ ] 認証コード入力後、1発でダッシュボードに遷移するように修正
- [ ] ログイン後のデモモード認証コード表示を完全に削除

## ログイン1発遷移の修正
- [x] ログイン成功時にすべてのトースト通知をクリアする処理を追加
- [x] window.location.hrefを使用して確実にダッシュボードにリダイレクト
- [x] Dashboard.tsxのReact hooksルール違反を修正（applyActivationCodeMutationを早期リターン前に移動）
- [x] 電話番号認証・メール認証・新規登録すべてで1発遷移を実現

## 新占い師追加（血液型占い師・動物占い師）
- [x] 血液型占い師のキャラクター設定を作成
- [x] 動物占い師のキャラクター設定を作成
- [x] 占い師画像を生成
- [x] oracles.tsに新しい占い師を追加
- [x] 多言語翻訳データを追加
- [x] 動作確認とテスト

## 管理画面の改善（電話番号認証ユーザー・合言葉状況）
- [x] 電話番号認証ユーザーを管理画面で表示
- [x] 合言葉（アクティベーションコード）付与状況を一目で確認できるようにする
- [x] 動作確認とテスト

## 紹介報酬制の導入（5人紹介で2,500円）
- [ ] 現在の紹介システムの構造を確認
- [ ] データベーススキーマに報酬関連テーブルを追加
- [ ] 紹介報酬のロジックを実装（有料会員登録時に1人500円の報酬付与）
- [ ] ユーザー向け報酬確認・振込申請画面を作成
- [ ] 管理者向け報酬管理・振込処理画面を作成
- [ ] 動作確認とテスト


## 紹介報酬制の導入（5人紹介で2,500円）
- [x] 現在の紹介システムの構造を確認
- [x] データベーススキーマに報酬関連テーブルを追加（referralRewards, payoutRequests, userBankAccounts）
- [x] 紹介報酬のロジックを実装（有料会員登録時に1人500円の報酬付与）
- [x] ユーザー向け報酬確認・振込申請画面を作成（/rewards）
- [x] 管理者向け報酬管理・振込処理画面を作成（/admin/rewards）
- [x] 動作確認とテスト

## 紹介報酬機能の強化
- [ ] ダッシュボードサイドバーに「紹介報酬」へのリンクを追加
- [ ] 振込手数料（300円）を設定し、最低出金額を調整
- [ ] 報酬獲得時のメール通知機能を追加
- [ ] 出金完了時のメール通知機能を追加
- [ ] 動作確認とテスト


## 紹介報酬機能の強化
- [x] ダッシュボードサイドバーに「紹介報酬」へのリンクを追加
- [x] モバイルナビにも「紹介報酬」へのリンクを追加
- [x] 振込手数料（300円）を設定し、最低出金額を800円に調整
- [x] 報酬獲得時のオーナー通知機能を追加
- [x] 出金完了時のオーナー通知機能を追加
- [x] 動作確認とテスト

## 紹介報酬機能の追加強化
- [ ] 紹介報酬ページの多言語対応（6言語）
- [ ] 報酬獲得時のユーザーメール通知機能を追加
- [ ] 紹介ランキング機能を実装
- [ ] 動作確認とテスト


## 紹介報酬機能の追加強化
- [x] 紹介報酬ページの多言語対応（6言語）
- [x] 報酬獲得時のユーザーメール通知機能を追加
- [x] 出金完了時のユーザーメール通知機能を追加
- [x] 出金却下時のユーザーメール通知機能を追加
- [x] 紹介ランキング機能を実装
- [x] 動作確認とテスト

## 紹介報酬の改善（5人ごと2,500円・30日継続後付与）
- [ ] 現在の紹介報酬ロジックを確認
- [ ] データベーススキーマを更新（30日継続チェック用フィールド追加）
- [ ] 報酬付与ロジックを変更（5人ごと・30日継続後に付与）
- [ ] 30日経過チェックのバッチ処理を実装
- [ ] UIを更新（報酬条件の説明を追加）
- [ ] 動作確認とテスト


## 紹介報酬の改善（5人ごと2,500円・30日継続後付与）
- [x] 現在の紹介報酬ロジックを確認
- [x] データベーススキーマを更新（30日継続チェック用フィールド追加）
- [x] 報酬付与ロジックを変更（5人ごと・30日継続後に付与）
- [x] 30日経過チェックのバッチ処理を実装
- [x] UIを更新（報酬条件の説明を追加）
- [x] 動作確認とテスト

## 継続ボーナス・バッチ自動化・キャンペーンバナー
- [x] 継続ボーナス機能を実装（3ヶ月500円、6ヶ月1,000円、12ヶ月2,000円）
- [x] 紹介報酬バッチ処理の自動化（毎日深夜に自動実行）
- [x] ランディングページに紹介キャンペーンバナーを追加
- [x] 動作確認とテスト


## SEO最適化（ホームページ）
- [x] キーワード数を9個から6個に削減
- [x] タイトルを31文字に最適化（document.title使用）
- [x] 動作確認


## 支払い方法変更・年額プラン廃止・報酬自動化
- [ ] 支払い方法を銀行振込のみに変更（Stripe決済を削除）
- [ ] 年額プランを廃止（月額プランのみに）
- [ ] 報酬付与の自動化プランを策定
- [ ] 報酬自動化の実装
- [ ] 動作確認


## 支払い方法変更・年額プラン廃止・報酬完全自動化
- [x] 支払い方法を銀行振込のみに変更（ランディングページ更新）
- [x] 年額プランを廃止（月額プランのみに）
- [x] 報酬付与の自動化プランを策定
- [x] 30日後自動承認機能の実装
- [x] 継続ボーナス自動付与機能の実装（3ヶ月500円、6ヶ月、1年）
- [x] 楽天銀行CSV形式での振込リスト自動生成機能
- [x] 動作確認（全404テスト通過）


## 振込完了通知・銀行口座事前登録機能
- [x] 振込完了時にユーザーへメール通知を送信する機能（既存のsendPayoutCompletedNotificationで実装済み）
- [x] ユーザーが出金申請前に銀行口座情報を事前登録できる画面（Rewards.tsxに実装済み）
- [x] 動作確認


## 出金履歴詳細表示・法的ページ更新
- [x] 出金履歴に振込日時・振込参照番号を表示
- [x] 特定商取引法に基づく表記を銀行振込対応に更新
- [x] プライバシーポリシーを銀行振込対応に更新
- [x] 利用規約を銀行振込対応に更新
- [x] 動作確認


## 特商法料金修正
- [x] 特定商取引法に基づく表記の料金を1,980円に修正


## 料金表示の統一（1,980円）
- [x] ランディングページ（Home.tsx）の料金を1,980円に更新（既に更新済み）
- [x] 利用規約（Terms.tsx）の料金を1,980円に更新


## 振込確認・プラン有効化機能
- [ ] 振込申請テーブルの追加（ユーザーが振込完了を申請）
- [ ] 管理者用振込確認・プラン有効化API
- [ ] 管理者画面に振込確認UIを追加
- [ ] 動作確認


## 振込確認・ワンクリックプラン有効化機能
- [x] 管理者用振込確認・プラン直接有効化API（confirmAndDirectActivate）を実装
- [x] 管理者画面にワンクリック有効化UIを追加
- [x] プラン有効化時の通知機能を実装（sendPlanActivatedNotification）
- [x] 動作確認


## プラン有効化時のメール通知機能
- [x] プラン有効化時にユーザーへ通知を送信する機能（アプリ内通知のみ、既存のsendPlanActivatedNotificationで実装済み）
- [x] 動作確認


## FAQページ作成
- [x] FAQページのコンテンツ設計（銀行振込手順、報酬システム、よくある質問）
- [x] FAQページの実装（アコーディオン形式、既存ページを更新）
- [x] フッターナビゲーションへの追加（既存）
- [x] 動作確認


## サポート問い合わせフォーム追加
- [x] 現在のサポート・問い合わせシステムを確認（Contact.tsxに実装済み）
- [x] サポート問い合わせフォームの実装（カテゴリ選択、詳細入力、既存）
- [x] FAQページとの連携（「解決しなかった場合」のリンク既存）
- [x] 動作確認


## 毎月の自動振込確認・合言葉送信システム
- [x] 現在の合言葉・振込確認システムを確認
- [x] 毎月の合言葉自動生成・更新機能を実装（monthlySubscriptionBatch.ts）
- [x] 振込確認後の自動合言葉送信機能を実装（既存のconfirmBankTransfer/confirmAndDirectActivateを活用）
- [x] 継続ユーザーへの3日前リマインド通知機能を実装（sendRenewalReminders）
- [x] 手順説明テンプレート（ユーザー向け・管理者向け）を作成（docs/subscription-management-guide.md）
- [x] 動作確認（ユニットテスト16件全てパス）


## 管理画面サブスクリプション統計 & メール送信機能
- [ ] 現在の管理画面構造とメール設定を確認
- [ ] Gmail/iCloudメール送信モジュールを実装（nodemailer使用）
- [ ] 管理画面にサブスクリプション統計ダッシュボードを追加
- [ ] メール送信機能を既存の通知システムに統合（合言葉発行、更新リマインド）
- [ ] 動作確認とテスト


## 管理画面サブスクリプション統計 & メール送信機能
- [x] 現在の管理画面構造とメール設定を確認
- [x] Gmail/iCloudメール送信モジュールを実装（nodemailer使用、emailService.ts）
- [x] 管理画面にサブスクリプション統計ダッシュボードを追加（AdminSubscriptionStats.tsx）
- [x] メール送信機能を既存の通知システムに統合（合言葉発行、更新リマインド、プラン有効化、期限切れ）
- [x] 動作確認とテスト（ユニットテスト12件全てパス）


## 3ヶ月継続報酬機能 & iCloudメール設定
- [ ] 3ヶ月継続報酬（500円）機能を設計・実装
- [ ] 継続報酬の説明をUIに追加（紹介ページ、サブスクリプションページ）
- [ ] iCloudメール設定を追加
- [ ] 動作確認とテスト


## 紹介コード入力欄の追加（登録時・ランディングページ）
- [x] 現在の紹介コードシステムと登録フローを確認
- [x] ランディングページ/ホームページに紹介コード入力欄を追加（Home.tsx）
- [x] 新規登録時に紹介コードを適用する機能を実装（Login.tsx + Dashboard.tsx）
- [x] 重複防止ロジックを実装（既存のapplyCode APIで対応済み）
- [x] 動作確認とテスト（ユニットテスト432件全てパス）


## 紹介ページQRコード生成機能
- [x] QRコード生成ライブラリを調査・インストール（qrcode.react）
- [x] 紹介ページにQRコード表示コンポーネントを追加（Referral.tsx）
- [x] 動作確認とテスト（TypeScriptエラーなし）


## 振込先情報の追加（特商表記・プライバシーポリシー・利用規約）
- [x] 特商表記・プライバシーポリシー・利用規約のファイルを確認
- [x] 各ページに振込先情報を追加（楽天銀行エンカ支店、金融コード0036、支店コード216）
- [x] 動作確認とテスト（TypeScriptエラーなし）


## サブスクリプションページ振込先情報 & コピーボタン
- [x] サブスクリプションページを確認
- [x] 振込先情報とコピーボタンを追加（BankInfoRowコンポーネント）
- [x] 動作確認とテスト（TypeScriptエラーなし）


## 解約時の注意事項追加（全料金体系ページ）
- [x] 特商表記に解約時の注意事項を追加（Legal.tsx）
- [x] 利用規約に解約時の注意事項を追加（Terms.tsx）
- [x] プライバシーポリシーに解約時の注意事項を追加（Privacy.tsx）
- [x] サブスクリプションページに解約時の注意事項を追加（Subscription.tsxの解約ダイアログ）
- [x] 動作確認とテスト（TypeScriptエラーなし）


## 継続特典進捗表示 & 報酬一元管理 & 出金申請機能（手動振込方式）
- [x] データベーススキーマに出金申請・振込先情報テーブルを追加（withdrawalRequests, userRewardBalances）
- [x] ダッシュボードに継続特典の進捗表示を追加（ContinuationBonusProgressコンポーネント）
- [x] ユーザー側：振込先口座登録・出金申請機能を実装（Withdrawal.tsx）
- [x] 管理画面：出金申請一覧・ステータス管理機能を実装（AdminWithdrawals.tsx - 未振込/振込済み/却下）
- [x] 動作確認とテスト（withdrawal.test.ts - 19テスト全てパス）


## 出金完了メール通知 & 振込予定日設定機能
- [x] データベーススキーマにscheduledTransferDateフィールドを追加（withdrawalRequests）
- [x] 管理者APIに振込予定日設定機能を追加
- [x] 出金完了時のメール通知機能を実装（sendWithdrawalApprovedNotification, sendWithdrawalCompletedNotification）
- [x] 管理画面UIに振込予定日入力欄を追加（AdminWithdrawals.tsx）
- [x] ユーザー側UIに振込予定日表示を追加（Withdrawal.tsx）
- [x] 動作確認とテスト（withdrawal.test.ts - 19テスト全てパス）


## 振込予定日デフォルト設定 & 未処理申請通知
- [x] 管理画面UIに振込予定日のデフォルト値（申請から7日後）を設定
- [x] 未処理申請（申請から3日以上経過）の管理者通知機能を実装（checkPendingWithdrawals）
- [x] 動作確認とテスト（withdrawal.test.ts - 19テスト全てパス）


## 友達紹介キャンペーン報酬制度の変更（双方向報酬）
- [x] 現在の紹介報酬システムの実装を確認
- [x] 報酬額の設定と黒字シミュレーション（紹介者500円、被紹介者100円 = 合計600円、利益1,380円/人）
- [x] 紹介報酬ロジックの変更（紹介者500円・被紹介者100円の双方向報酬）
- [x] フロントエンドUIの更新（双方向報酬の説明を追加）
- [x] 動作確認とテスト（rewards.test.ts - 17テスト全てパス）


## 紹介報酬3ヶ月継続条件 & 紹介一元管理システム
- [x] 紹介報酬の条件を30日から3ヶ月（90日）継続に変更
- [x] 管理者向け紹介一元管理APIの作成（getReferralRelationships, getReferralStatistics）
- [x] 管理画面に紹介一元管理ページを作成（AdminReferrals.tsx）
- [x] UIの説明文を3ヶ月継続条件に更新（全言語対応）
- [x] 動作確認とテスト（rewards.test.ts - 17テスト全てパス）


## 継続ボーナス金額変更（月200円）
- [x] 継続ボーナスの金額を月500円から月200円に変更（3ヶ月600円、6ヶ月1,200円、12ヶ月2,400円）
- [x] UIの説明文を更新（3ヶ月で600円、6ヶ月で1,200円、12ヶ月で2,400円）
- [x] 動作確認とテスト（rewards.test.ts - 17テスト全てパス）


## 報酬シミュレーター & 3ヶ月継続達成通知
- [x] 報酬シミュレーターコンポーネントの作成（RewardSimulator.tsx - 紹介人数・継続月数から予想報酬額を計算）
- [x] 被紹介者の3ヶ月継続達成時に紹介者へ通知を送信する機能を実装（sendReferralMilestoneNotification）
- [x] 動作確認とテスト（rewards.test.ts - 17テスト全てパス）


## 最低出金額の変更（500円→1,000円）
- [x] バックエンドの最低出金額を1,000円に変更
- [x] フロントエンドUIの最低出金額表示を更新（Withdrawal.tsx）
- [x] 動作確認とテスト（withdrawal.test.ts - 19テスト全てパス）


## 紹介報酬ページの新報酬制度対応
- [x] 現在のReferral.tsxの内容を確認
- [x] 新しい報酬制度に合わせてUIを更新（3ヶ月継続条件、双方向報酬、継続ボーナス月200円）
- [x] 動作確認とテスト（rewards.test.ts - 17テスト全てパス）


## 紹介報酬ページの説明文修正（正しい報酬制度）
- [x] 翻訳ファイルの説明文を修正（紹介報酬は3ヶ月継続後確定、継続ボーナスは3ヶ月継続後から毎月200円）
- [x] 動作確認とテスト（rewards.test.ts - 17テスト全てパス）


## 紹介報酬ページの説明文修正（継続ボーナスは1ヶ月目から）
- [x] 翻訳ファイルの説明文を修正（継続ボーナスは1ヶ月目から毎月200円、紹介報酬は3ヶ月後に付与）
- [x] 動作確認とテスト

## Rewards.tsxとContinuationBonusProgress.tsxのハードコードされた説明文修正
- [x] reward500の翻訳を修正（紹介報酬500円 + 被紹介者100円を明記）
- [x] reward5peopleの翻訳を修正（継続ボーナスと紹介報酬の合計を明記）
- [x] minWithdrawalの翻訳を修正（最低出金額1,000円に変更）
- [x] ContinuationBonusProgress.tsxの説明文を修正（継続ボーナスは1ヶ月目から毎月200円）
- [x] myCodeDescriptionの翻訳を修正（正しい報酬制度を反映）

## 紹介キャンペーンチュートリアル作成
- [ ] 現在の法的ページ（特商法・利用規約・プライバシーポリシー）を確認
- [ ] 紹介キャンペーンチュートリアルコンポーネントを作成
- [ ] FAQに紹介キャンペーンの詳細手順を追加
- [ ] ヘルプページに紹介キャンペーンの詳細手順を追加
- [ ] 法的ページに紹介キャンペーンに関する記載を追加（必要に応じて）
- [ ] 動作確認とテスト


## 紹介キャンペーンチュートリアル作成
- [x] 現在の法的ページ（特商法・利用規約・プライバシーポリシー）を確認
- [x] 紹介キャンペーンチュートリアルコンポーネントを作成
- [x] FAQとヘルプページに紹介キャンペーンの詳細手順を追加
- [x] 法的ページに紹介キャンペーンに関する記載を追加（必要に応じて）


## 今月の合言葉機能
- [ ] データベーススキーマに合言葉テーブルを追加（monthly_codes, code_usages）
- [ ] 合言葉生成・管理のAPIを実装（新規作成、一覧、使用状況確認）
- [ ] 管理画面に合言葉管理UIを追加
- [ ] ユーザー側の合言葉入力・検証機能を実装（1人1回のみ使用可能）


## 今月の合言葉機能
- [x] データベーススキーマに合言葉テーブルを追加（monthly_activation_codes, monthly_code_usages）
- [x] 合言葉生成・管理のAPIを実装（新規作成、ランダム生成、一覧、使用状況確認、有効化/無効化）
- [x] 管理画面に合言葉管理UIを追加（/admin/monthly-code）
- [x] ユーザー側の合言葉入力・検証機能を実装（/monthly-code、1人1回のみ使用可能）


## 合言葉の月1回制限解除
- [x] APIの月1回制限チェックを削除
- [x] フロントエンドの使用済み表示を修正（何度でも使用可能に）
- [x] 既存の使用履歴をリセット（テスト用）


## 合言葉のログイン不要化
- [x] 合言葉APIをpublicProcedureに変更（ログイン不要）
- [x] フロントエンドのログインリダイレクトを削除
- [x] 電話番号入力でプレミアム付与できるように修正


## 管理者によるプレミアム付与機能
- [x] 管理画面にユーザー一覧APIを追加（ログイン済みユーザーを表示）
- [x] 管理者が今月のみプレミアムを付与できるAPIを追加
- [x] 管理画面UIにユーザー管理ページを作成（/admin/users）
- [x] ユーザーごとにプレミアム付与ボタンを表示


## プレミアム付与履歴と期間カスタマイズ機能
- [ ] データベースにプレミアム付与履歴テーブルを追加（premium_grant_history）
- [ ] 履歴記録APIを実装（付与時に自動記録）
- [ ] 期間カスタマイズAPIを実装（任意の日数を指定可能）
- [ ] 管理画面UIに履歴表示機能を追加
- [ ] 管理画面UIに期間選択ダイアログを追加


## プレミアム付与履歴と期間カスタマイズ機能
- [x] データベースにプレミアム付与履歴テーブルを追加（premium_grant_history）
- [x] 履歴記録APIを実装（付与時に自動記録）
- [x] 期間カスタマイズAPIを実装（任意の日数を指定可能）
- [x] 管理画面UIに履歴表示機能を追加（紫色の履歴ボタン）
- [x] 管理画面UIに期間選択ダイアログを追加（今月末/7日/30日/90日/カスタム）


## 合言葉生成時の自動有効化
- [x] 新しい合言葉を生成した時に最新のものを自動的に有効化するように修正（他の合言葉は自動無効化）


## 合言葉コピーボタンのエラー修正
- [ ] コピーボタンを押した時のエラーを調査
- [ ] コピー機能を修正

## 管理者合言葉機能の修正（2026-01-30）
- [x] 管理者APIをトークンベースの認証に変更
  - adminAccessルーターに合言葉管理機能を追加
  - getMonthlyActivationCodes, getMonthlyCodeUsages, createMonthlyActivationCode, generateRandomMonthlyCode, deactivateMonthlyCode, activateMonthlyCodeをトークンベースに変更
- [x] データベーススキーマのcreatedByAdminIdフィールドをnull許容に変更
- [x] フロントエンドのAPI呼び出しにトークンパラメータを追加
- [x] 合言葉のコピー＆ペースト機能を確認（空白を含む入力でも正常に動作）

## 1日経つと自動回復する機能（共通実装）
- [x] 共通の自動回復システムを設計・実装
  - dailyReset.tsに共通ユーティリティを作成
  - 日本時間(JST)ベースのリセットロジック
  - 毎日深夜0時（日本時間）に自動リセット
- [x] プレミアムプラン: 日次鑑定回数の自動リセット（50回/日）
- [x] スタンダードプラン: 日次鑑定回数の自動リセット（15回/日）
- [x] トライアルプラン: 占い師ごとの交換回数の自動リセット（3回/占い師）
- [x] 紹介コード: 月次使用回数の自動リセット（10回/月）- JSTベースに更新
- [x] SMS認証: 日次再送回数の自動リセット（5回/日）- JSTベースに更新
- [x] フロントエンドに自動回復の表示を追加（次回リセットまでの時間表示）
  - useResetCountdownフックを作成
  - Dashboardにリセットカウントダウンを追加
- [x] 管理者用バッチリセットAPIを追加
  - runDailyUsageReset: 日次リセットを手動実行
  - runMonthlyUsageReset: 月次リセットを手動実行
  - runAllDailyTasks: 全タスクを実行（リセット含む）


## 年間プラン削除（2026-01-30）
- [x] 管理画面から年間プラン発行ボタンを削除
- [x] サーバー側の年間プラン関連コードを削除/調整
- [x] フロントエンドの年間プラン表示を削除
- [x] 振込申請画面から年間プラン選択を削除

※月額プラン（¥1,980 / 30日）のみにシンプル化


## 紹介・報酬管理ルールの修正（2026-01-30）
- [x] サーバー側の報酬ロジックを修正
  - 継続ボーナス: 3ヶ月継続ごとに600円（月額200円×3ヶ月）
  - 紹介報酬: 3ヶ月継続後に紹介者500円、被紹介者100円
  - 出金条件: 90日（3ヶ月）継続後に確定
- [x] 利用規約を修正
- [x] プライバシーポリシーを修正
- [x] 特商法表記を修正
- [x] 紹介ボーナスの説明文/チュートリアルを修正（翻訳ファイル）
- [x] FAQを修正（全6言語）
  - 継続ボーナスの説明を「3ヶ月継続ごとに600円」に統一
  - 出金手数料を「ユーザー負担（実費）」に変更
  - 最低出金額1,000円を明記

**確定した報酬ルール:**
| 項目 | 内容 |
|------|------|
| 紹介ボーナス（単発） | 紹介者500円 + 被紹介者100円（3ヶ月継続後に確定） |
| 継続ボーナス（毎月） | 月額200円固定（紹介有無に関係なく、3ヶ月継続ごとに付与） |
| 最低出金額 | 1,000円から |
| 振込手数料 | ユーザー負担（実費） |


## 出金申請フローの修正（2026-01-30）
- [x] 振込手数料の表示を「¥300」→「ユーザー負担（実費）」に変更
  - translations.ts: transferFee翻訳を全6言語で修正
- [x] 最低出金額を「800円」→「1,000円」に変更
  - translations.ts: minPayoutNote翻訳を全6言語で修正
  - Rewards.tsx: フロントエンドの最低出金額チェックを修正
  - routers.ts: サーバー側の最低出金額チェックを修正
- [x] サーバー側の振込手数料処理を修正
  - 振込手数料は差し引かず、実際の振込時に管理者が考慮


## プレミアムプラン無制限化（2026-01-31）
- [x] プレミアムプランの鑑定回数制限を撤廃（無制限に変更）
- [x] スタンダードプランの鑑定回数制限を撤廃（無制限に変更）
- [x] 不自然なbot対策のみを維持
- [x] フロントエンドの残り回数表示を調整（「無制限」表示）
- [x] テストと動作確認（477テスト合格）


## 銀行振込プレミアムプラン管理機能（2026-01-31）
- [ ] 管理者が銀行振込確認後、1ヶ月分の合言葉を自動送信する機能
- [ ] 管理者画面でアカウントごとにプレミアムプランを有効化/無効化
- [ ] プレミアムプラン期間の管理（開始日・終了日）
- [ ] 管理者権限での一元管理UI
- [ ] テストと動作確認


## テスター機能と不具合報告フォーム（2026-01-31）
- [ ] usersテーブルにisTesterフラグを追加
- [ ] 管理画面でテスタータグの表示・切り替え機能
- [ ] 不具合報告専用フォームの実装（ユーザー側）
- [ ] 不具合報告の管理画面（管理者側）
- [ ] テストと動作確認


## テスター機能と不具合報告フォーム（2026-01-31）
- [x] usersテーブルにisTesterフラグを追加
- [x] 管理画面でテスタータグの表示・切り替え機能
- [x] 不具合報告専用フォームの実装（ユーザー側）
  - カテゴリ「バグ報告」選択時に詳細フィールドを表示
  - 再現手順、期待動作、実際の動作、デバイス情報、優先度
  - 6言語対応
- [x] 管理画面でプレミアム付与をわかりやすく表示（バッジ、有効期限）
- [x] テスト完了（477テスト合格）


## プレミアムプラン回数制限表示の修正（2026-01-31）
- [ ] プレミアムプランの回数制限表示を「無制限」に修正
- [ ] 「本日の残り」「本日 X/X 回使用済み」の表示を無制限対応に
- [ ] 振込申請フローの確認と改善

- [ ] 「振込完了を報告」ボタンをユーザー側に追加
- [ ] 振込完了報告時に管理者に通知
- [ ] 管理画面で「承認」ボタンのみでプレミアム有効化（合言葉不要）


## プレミアムプラン回数制限表示の修正（2026-01-31）
- [x] プレミアムプランの回数制限表示を「無制限」に修正（planType: 'premium'も対応）
- [x] 「振込完了を報告」ボタンをユーザー側に追加
- [x] 振込完了報告時に管理者に通知
- [x] 管理画面で「承認」ボタンのみでプレミアム有効化（合言葉不要）
- [x] 管理画面に「振込完了報告済み」バッジを表示


## 重複ログイン防止機能（2026-01-31）
- [x] セッショントークンをデータベースで管理
- [x] 新しいログイン時に古いセッションを無効化
- [x] 重複ログイン検出時にユーザーに通知（「別のデバイスでログインされました」）
- [x] テストと動作確認（477テスト合格）


## プレミアムアップグレード申請機能（2026-01-31）
- [ ] 新規ユーザーのデフォルトプランをトライアル（制限あり）に変更
- [ ] 「プレミアムプランにアップグレード」申請ボタンを追加
- [ ] 申請時に管理者に通知を送信
- [ ] 管理者が通知から承認画面に自動遷移
- [ ] 承認ボタンでプレミアムプラン有効化
- [ ] テストと動作確認


## プレミアムアップグレード申請機能（2026-01-31）
- [x] アップグレード申請テーブルをデータベースに追加
- [x] 「プレミアムプランにアップグレード」申請ボタンを追加
- [x] 申請時に管理者に通知を送信
- [x] 管理者用アップグレード申請管理ページを作成（/admin/upgrade-requests）
- [x] 承認ボタンでプレミアムプラン有効化（30日間）
- [x] テストと動作確認（477テスト合格）


## チャット入力欄スクロール不具合修正（2026-01-31）
- [ ] ダッシュボードのチャット入力欄が画面下部に隠れる問題を調査
- [ ] スクロールできない問題を修正
- [ ] 入力欄が常に表示されるようにレイアウトを調整


## チャット入力欄スクロール不具合修正（2026-01-31）
- [x] ダッシュボードのチャット入力欄が画面下部に隠れる問題を調査
- [x] スクロールできない問題を修正（h-screenとoverflow-hiddenを適用）
- [x] 入力欄が常に表示されるようにレイアウトを調整（flex-1とmin-h-0を適用）


## 占い鑑定画面UI改善（2026-01-31）
- [ ] 現在の鑑定画面のUIを確認・問題点を特定
- [ ] チャットメッセージの視認性を向上（フォントサイズ、コントラスト、余白）
- [ ] 占い師と自分のメッセージを明確に区別
- [ ] 鑑定結果の読みやすさを改善


## 占い鑑定画面UI改善（2026-01-31）
- [x] 現在の鑑定画面のUIを確認・問題点を特定
- [x] チャットメッセージの視認性を向上（フォントサイズ、コントラスト、余白）
- [x] 占い師と自分のメッセージを明確に区別（chat-message-oracle/chat-message-userクラス）
- [x] 鑑定結果の読みやすさを改善（テーブル、見出し、リストのスタイル改善）


## モバイル版占い画面の修正（2026-01-31）
- [ ] モバイル版でメッセージ入力欄が表示されない問題を修正
- [ ] キャラクター選択をシンプルでわかりやすく改善
- [ ] モバイルでの占い機能が正常に動作することを確認


## モバイル版占い画面の修正（2026-01-31）
- [x] モバイル版でメッセージ入力欄が表示されない問題を修正
- [x] キャラクター選択をシンプルでわかりやすく改善
- [x] モバイルでの占い機能が正常に動作することを確認


## チャット画面のLINE風UI改善（2026-01-31）
- [x] 現在のチャット画面の問題点を特定
- [x] LINE風の吹き出しデザインに変更（自分は右側・オレンジグラデーション、占い師は左側・ダーク）
- [x] 占い師のアバター画像をメッセージ横に表示
- [x] メッセージ間の余白を適切に調整
- [x] キャラクター選択をカード形式でわかりやすく表示
- [x] 入力欄を常に下部に固定（LINEのように）


## チャット画面追加改善（2026-01-31）
- [ ] メッセージ送信時のふわっとしたアニメーションを追加
- [ ] 占い師の応答中・応答完了の既読表示を追加
- [ ] モバイル入力欄の最終調整（safe-area対応）


## チャット画面追加改善（2026-01-31）
- [x] メッセージ送信時のふわっとしたアニメーションを追加
- [x] 占い師の応答中・応答完了の既読表示を追加
- [x] モバイル入力欄の最終調整（safe-area対応）


## スタンプ・絵文字機能追加（2026-01-31）
- [ ] スタンプ・絵文字ピッカーUIを実装
- [ ] スタンプ送信機能を実装
- [ ] スタンプがチャット画面に表示されるようにする


## スタンプ・絵文字機能追加（2026-01-31）
- [x] スタンプ・絵文字ピッカーUIを実装（4カテゴリ：基本、感情、占い、リアクション）
- [x] スタンプ送信機能を実装（テキストエリアに絵文字を挿入）
- [x] スタンプがチャット画面に表示されるようにする
- [x] スタンプピッカーのアニメーションとホバーエフェクトを追加


## PWA（ホーム画面追加）機能（2026-01-31）
- [x] PWAマニフェスト（manifest.json）を作成
- [x] アプリアイコン（192x192、512x512）を設定
- [x] Service Workerを設定
- [x] ログイン後にホーム画面追加プロンプトを表示
- [x] インストール済みかどうかの検出機能を追加


## ブランドロゴ差し替え（2026-01-31）
- [x] ロゴ画像をプロジェクトにコピー
- [x] ホーム画面のタイトルロゴを新しいブランドロゴに差し替え


## ロゴ背景切り抜き（2026-01-31）
- [x] ブランドロゴの背景を透過にして切り抜き
- [x] 切り抜いたロゴをホーム画面に適用


## ロゴ切り抜き修正（2026-01-31）
- [x] 元の写真からロゴ部分を切り抜き（オリジナルのゴールドカラーを維持）
- [x] 背景を透過にして保存
- [x] ホーム画面に適用

## ロゴ切り抜き修正v2（2026-01-31）
- [x] ロゴの下部分が欠けている問題を修正
- [x] フルサイズでロゴを切り抜き直す
- [x] ホーム画面に適用

## 白いアドレスバー削除（2026-01-31）
- [ ] ホーム画面上部の白いアドレスバー（プレビューUI）を消す

## ロゴを神社ロゴに戻す（2026-01-31）
- [ ] 前の神社ロゴに戻す


## ロゴを神社ロゴに戻す（2026-01-31）
- [x] 前の神社ロゴに戻す（logo.webp）


## 神社画像の調整とPWAアイコン更新（2026-01-31）
- [x] 神社画像の角丸を削除（自然な見た目に）
- [x] PWAアイコンを神社画像に更新（192x192、512x512）
- [x] apple-touch-iconを更新（180x180）
- [x] faviconを更新（32x32）


## OGP画像更新（2026-01-31）
- [x] OGP画像を神社画像に更新（1200x630）


## かんたんモード削除（2026-01-31）
- [x] ホーム画面のかんたんモードボタンを削除


## 月額プラン無制限化（2026-01-31）
- [ ] ホームページのプラン比較・料金表記を無制限に更新
- [ ] FAQページの表記を更新
- [ ] 特商法の表記を更新
- [ ] プライバシーポリシーの表記を更新
- [ ] 利用規約の表記を更新
- [ ] 不正利用対策（bot対策・レート制限）を実装


## 月額プラン無制限化（2026-01-31）
- [x] ホームページのプラン比較・料金表記を無制限に更新
- [x] FAQ翻訳ファイルの表記を更新
- [x] 特商法・プライバシーポリシー・利用規約を更新
- [x] 不正利用対策（bot対策・レート制限）を利用規約に追加
- [x] サーバー側の不正利用対策は既に実装済み（bot検出・レート制限）
- [x] トライアルプロトコルの料金表記を更新
- [x] サービス情報の料金表記を更新

## 不正利用検出通知機能（2026-01-31）
- [x] 異常な利用パターンを検出した際に管理者に通知する機能を追加
- [x] bot検出時の通知（疑わしさスコアが閾値を超えたら通知）
- [x] レート制限超過時の通知（5分以内に10回連続違反で通知）
- [x] 短時間での大量リクエスト検出時の通知（レート制限違反と統合）

## 不正利用対策強化（2026-01-31）
- [x] データベースにブロック・不正利用ログテーブルを追加
- [x] 不正検知時の自動アカウント停止機能を実装
- [x] 停止時の警告文を表示
- [x] 管理者手動ブロック機能を実装（blockUser, unblockUser）
- [x] 不正利用ログの保存機能を実装（getSuspiciousActivityLogs）


## ユーザーフィードバック対応（2026-02-01）
- [ ] PWAインストールを促すバナーやボタンを追加
- [ ] 電話ログインをワンステップで直感的に改善
- [ ] 「あなたの悩みをお聞かせください」の色を明るく変更（タップしやすい安心感のある色に）


## ユーザーフィードバック対応（2026-02-01）
- [x] PWAインストールを促すバナーをホーム画面に追加（iOSガイド付き）
- [x] 電話ログインをワンステップで直感的に改善（「無料で始める」ボタン）
- [x] 「あなたの悩みをお聞かせください」の色を明るく変更（アンバー・ゴールド系）

## ダッシュボードPWA案内とチュートリアル強化（2026-02-01）
- [x] ダッシュボードにPWAインストール案内を追加（PWAInstallPromptコンポーネント統合済み）
- [x] 初回ログイン時のチュートリアルを強化（OnboardingTourにPWAステップを追加）


## 占い師キャラクター個性強化（2026-02-01）
- [x] 各占い師のプロンプト設定を確認
- [x] 蒼真（時の賢者）の個性的な口調を設定
- [x] 玲蘭（癒しの巫女）の個性的な口調を設定
- [x] 朔夜（数秘の使い手）の個性的な口調を設定
- [x] 灯（タロットの導き手）の個性的な口調を設定
- [x] 結衣（夢見の乙女）の個性的な口調を設定
- [x] 玄（守護の武人）の個性的な口調を設定
- [x] 紫苑（手相の達人）の個性的な口調を設定
- [x] 星蘭（星読みの姫）の個性的な口調を設定
- [x] 緋月（血液型の巫女）の個性的な口調を設定
- [x] 獣牙（動物占いの使い手）の個性的な口調を設定
- [x] 会話を自然に展開するようプロンプトを調整
- [x] AIっぽさを排除した自然な会話スタイルに修正

## 無料お試し表示削除（2026-02-01）
- [x] ホームページから「無料で始める」ボタンを削除（「今すぐ始める」に変更済み）
- [x] ダッシュボードから「初回お試し」表示を削除（ヘッダー、サイドバー、メインエリア）
- [x] 管理者権限で1ヶ月無制限利用できる形に修正（OnboardingTourのプラン説明を更新）

## 管理画面とホームページ調整（2026-02-01）
- [x] 管理画面のユーザー管理機能を確認（AdminUsersページにプレミアム付与機能実装済み）
- [x] 1ヶ月無制限付与機能の実装状況を確認（30日/90日/カスタム日数の付与が可能）
- [x] ホームページの「今すぐ始める」ボタンのリンク先を確認（ログイン後は/dashboardへ遷移）


## 「無料で始める」を「ログイン」に修正（2026-02-01）
- [x] ホームページの「今すぐ始める」ボタンを「ログイン」に変更
- [x] 多言語対応の翻訳も更新（日本語:ログイン、英語:Login）


## ChatGPT差別化機能（2026-02-01）

### ① 占術データの非公開プロンプト化
- [x] 今日の干支計算ロジックをサーバー側に実装（fortuneCalculations.ts）
- [x] 六神（青龍・朱雀・勾陳・螣蛇・白虎・玄武）の日別計算
- [x] 相談者の生年月日から宿命を計算するロジック（五行・命式分析）
- [x] AIには計算結果のみを渡して解説させる仕組み（routers.tsに統合）

### ② 連続性と記憶の演出
- [x] 鑑定履歴に基づくフォローアップ通知機能（followupNotifications.ts）
- [x] 「あの時の悩みはどうなりましたか？」自動リマインド（3日後に自動送信）
- [x] 月ごとの六神パーソナライズ通知（月初めに全ユーザーに送信）

### ③ 占い専用の出力・演出
- [ ] 六神キャラクター別のお守り画像生成（次のフェーズで実装予定）
- [x] 鑑定結果のPDF鑑定書ダウンロード機能（pdfGeneration.ts + API実装済み）


## お守り画像生成とPDFダウンロードボタン（2026-02-01）
- [x] お守り画像生成API（各占い師キャラクター別）- omamoraGeneration.ts + chat.generateOmamori API
- [x] お守り画像ダウンロード機能のUI（Dashboard.tsxに「お守り」ボタン追加）
- [x] チャット画面にPDF鑑定書ダウンロードボタンを追加（「鑑定書」ボタン）
- [x] 鑑定終了後のワンクリックダウンロード機能（アシスタントメッセージの下にボタン表示）

## ログイン画面ボタン修正（2026-02-01）
- [x] ログイン画面の「無料で始める」ボタンを「ログイン」に変更（Login.tsx）

## チャット入力欄のLINEスタイル改善（2026-02-01）
- [x] 現在のチャット入力欄の実装を確認
- [x] 複数行入力対応（textarea + 自動高さ調整）
- [x] 絵文字ボタンの追加（StampPickerを左側に配置）
- [x] 送信ボタンを右側に配置（丸いボタン）
- [x] 入力欄のデザインをLINE風に調整（角丸、白背景、グレー入力欄）

## プレースホルダーカスタマイズとタイピングインジケーター（2026-02-01）
- [ ] 占い師ごとのプレースホルダーテキストを設計
- [ ] プレースホルダーのカスタマイズを実装
- [ ] タイピングインジケーター（「〇〇が考えています...」）を実装
- [ ] アニメーション効果を追加

## プレースホルダーカスタマイズとタイピングインジケーター（2026-02-01）
- [x] 占い師ごとのプレースホルダーテキストを設計（10人分の個性的なテキスト）
- [x] プレースホルダーのカスタマイズを実装（Dashboard.tsx）
- [x] タイピングインジケーター（「〇〇が鑑定中...」→占い師ごとのメッセージ）を実装
- [x] アニメーション効果を追加（既存のoracle-typing-dotsアニメーションを活用）


## お気に入り占い師機能（2026-02-02）
- [x] データベースにお気に入りテーブルを追加（favorite_oracles）
- [x] お気に入り追加/削除のAPIを実装
- [x] ダッシュボードでお気に入り占い師を優先表示
- [x] お気に入りボタンのUIを追加（ハートアイコン）
- [x] お気に入り占い師一覧ページを作成（/favorites）

## 占い結果のカテゴリ分け機能（2026-02-02）
- [x] チャットログにカテゴリフィールドを追加（恋愛・仕事・健康・金運・人間関係・その他）
- [x] カテゴリ自動判定ロジックを実装（LLMで分析）
- [x] カテゴリ別フィルター機能を実装
- [x] 鑑定履歴ページにカテゴリフィルターUIを追加

## 占い師からの定期メッセージ機能（2026-02-02）
- [x] 定期メッセージ設定テーブルを追加（scheduled_messages, user_message_preferences）
- [x] 週間運勢メッセージ生成ロジックを実装
- [x] 占い師選択・配信設定UIを追加
- [x] ダッシュボードに定期メッセージ表示エリアを追加
- [x] 定期メッセージ一覧ページを作成（/messages）
- [x] メッセージ設定ページを作成（/message-settings）


## AI推論能力強化とキャラクター世界観維持（2026-02-02）
- [ ] 現在のプロンプト設定を確認・分析
- [ ] 思考の連鎖（Chain of Thought）をプロンプトに導入
- [ ] 不自然な入力（「あ」など）へのキャラクターらしい対応を実装
- [ ] 悩みへの共感と具体的アドバイスの強化
- [ ] GeminiやChatGPTレベルの推論能力を維持しつつ世界観を保つ
- [ ] テストと動作確認


## AI推論能力強化とキャラクター世界観維持（2026-02-02 完了）
- [x] 思考の連鎖（Chain of Thought）プロンプトを追加
- [x] 不自然な入力への対応ルールを追加
- [x] 各占い師ごとの聞き返しパターンを定義
- [x] 推論能力強化ルールをCOMMON_ORACLE_RULESに追加
- [x] 深い共感と具体的アドバイスのバランスルールを追加


## デジタルコンパニオン機能の実装（2026-02-02）

### 見守りモードと重要暦通知
- [ ] ユーザー設定テーブルに見守りモードフラグを追加
- [ ] 重要な暦（節分、新月、春分など）のマスターデータを作成
- [ ] ユーザーの大切な日（記念日）を登録するテーブルを追加
- [ ] 見守りモード設定UIを作成
- [ ] 記念日登録UIを作成
- [ ] 重要な日だけにAIからメッセージを送る通知ロジックを実装

### 日常共有機能
- [ ] 日常共有モードのプロンプトを追加（悩み解決ではなく肯定）
- [ ] 六神視点で日常を運命とリンクさせる返答ロジックを実装
- [ ] 会話タイプ（相談/日常共有）の切り替えUIを追加

### 親密度システム
- [ ] 親密度テーブルを追加（ユーザー×占い師ごと）
- [ ] ログイン継続で親密度が上がるロジックを実装
- [ ] 親密度レベルに応じた特典（画像生成の豪華さなど）を定義
- [ ] 親密度表示UIを作成
- [ ] 特典解放の通知機能を実装

### 記憶の継続性強化
- [ ] 過去の相談を覚えていることを明示する返答パターンを追加
- [ ] 「前回の相談」サマリー表示機能を追加
- [ ] 長期記憶の可視化UI（タイムライン表示など）を作成

### 法的文書の更新
- [ ] 特定商取引法に基づく表記をデジタルコンパニオン向けに更新
- [ ] プライバシーポリシーを更新
- [ ] 利用規約を更新


## デジタルコンパニオン機能の実装（2026-02-02 完了）
- [x] 見守りモード機能を実装（ユーザーが「今日は見守りモードで」を選べる設定）
- [x] 重要な暦・記念日通知機能を実装（節分、新月、ユーザー設定の大切な日）
- [x] 日常共有機能と六神視点の返答ロジックを実装（日常を占い師の視点で肯定）
- [x] 親密度システムと特典解放機能を実装（ログイン継続で親密度UP、特典解放）
- [x] 記憶の継続性強化（過去の相談を明示）を実装
- [x] 特定商取引法に基づく表記をデジタルコンパニオンサービスとして更新
- [x] プライバシーポリシーをデジタルコンパニオンサービスとして更新
- [x] 利用規約をデジタルコンパニオンサービスとして更新


## チャット画面の文字入力欄改善（2026-02-02 完了）
- [x] 文字入力欄を広くする（min-height: 44px→60px, max-height: 120px→150px, rows: 1→2）
- [x] 音声入力との切り替え時も使いやすくする


## チャット入力欄の追加改善（2026-02-02 完了）
- [x] 入力欄のフォントサイズ調整（text-lg, fontSize: 16pxでモバイルで見やすく）
- [x] 音声入力ボタンの位置調整（入力欄の右側、送信ボタンの横に配置）
- [x] 長文プレビュー機能の実装（100文字以上でプレビューボタン表示、モーダルで編集・送信可能）


## プレミアムプラン無制限化（2026-02-02）
- [ ] プレミアムプランの50回制限を撤廃
- [ ] 制限表記をUIから削除
- [ ] 無制限を明示する表記に変更


## プレミアムプラン無制限化（2026-02-02 完了）
- [x] プレミアムプランの50回制限を撤廃（dailyReadingLimit: -1）
- [x] 制限表記をUIから削除（Dashboard, Subscription, emailService）
- [x] 無制限を明示する表記に変更（「鑑定無制限」「回数制限なし」）


## 親密度UI・記念日登録・見守りモード（2026-02-02 完了）
- [x] 親密度UIをダッシュボードに統合（ウィジェット追加）
- [x] 記念日登録フォームを作成（/special-datesページ）
- [x] 見守りモード切り替えボタンをチャット画面に追加


## 見守りモード・親密度・リマインダー機能強化（2026-02-02）
- [ ] 見守りモード時の自動メッセージ機能（暦イベント：新月・満月・節分など）
- [ ] 親密度レベルアップ演出（アニメーション・特典解放通知）
- [ ] 大切な日のリマインダー通知（登録日が近づいたら占い師からメッセージ）


## 見守りモード・親密度・リマインダー機能強化（2026-02-02 完了）
- [x] 見守りモード時の自動メッセージ機能（暦イベント：新月・満月・節分など）
- [x] 親密度レベルアップ演出（アニメーション・特典解放通知）
- [x] 大切な日のリマインダー通知（登録日が近づいたら占い師からメッセージ）


## バグ修正（2026-02-02 完了）
- [x] プレミアムユーザーの鑑定機能エラーを修正（IntimacyDisplayのフック呼び出し修正）


## UI問題修正（2026-02-02）
- [ ] ログイン画面の「ホームに戻る」ボタンが反応しない問題を修正
- [ ] 六神ノ間チュートリアルのボタンが反応したりしなかったりする問題を修正
- [ ] チャット入力欄の幅が元に戻っている問題を修正


## UI問題修正（2026-02-02 完了）
- [x] ログイン画面の「ホームに戻る」ボタンが反応しない問題を修正（z-indexとpointer-events追加）
- [x] 六神ノ間チュートリアルのボタンが反応したりしなかったりする問題を修正（pointer-events-auto追加）
- [x] チャット入力欄の幅を復元（外側の枠全体を入力エリアに変更）


## チャットUI改善（2026-02-02 完了）
- [x] キーボード表示時の入力欄位置調整（モバイルでキーボードが表示された時に入力欄が隠れないように）
- [x] 送信後の自動スクロール（新しいメッセージが表示されたら最下部にスムーズスクロール）


## 回答テキスト視認性改善（2026-02-02 完了）
- [x] 占い師の回答テキストの色・コントラストを改善して見やすくする（純白#ffffffに変更、フォントサイズ拡大、行間拡大）


## チャット画面レイアウト改善（2026-02-02）
- [ ] 回答メッセージが長い場合でもスクロールなしで読めるようにレイアウトを改善

## チャット画面レイアウト改善（2026-02-02）
- [x] 回答メッセージが長い場合でもスクロールなしで読めるようにレイアウトを改善
- [x] 手相鑑定のコツカードを折りたたみ式に変更してチャットエリアを広く確保


## メッセージ「続きを読む」機能（2026-02-02）
- [x] 長い回答メッセージを最初の数行だけ表示する機能を実装
- [x] 「続きを読む」ボタンで全文を展開できるようにする
- [x] 展開後は「閉じる」ボタンで折りたためるようにする
- [x] モバイルでも使いやすいUIにする


## 占い師切り替え時のチャット履歴保持（2026-02-02）
- [x] 各占い師ごとのチャット履歴を個別に管理する
- [x] 占い師を切り替えても履歴が消えないようにする
- [x] 再度同じ占い師を選択したときに以前の履歴が表示される


## チャット履歴のデータベース保存（2026-02-02）
- [x] chat_messagesテーブルを作成（ユーザーID、占い師ID、メッセージ内容、役割、タイムスタンプ）
- [x] メッセージ送信時にデータベースに保存するAPIを実装
- [x] ログイン時に過去の履歴を読み込むAPIを実装
- [x] フロントエンドで履歴を読み込んで表示

## 履歴クリアボタン（2026-02-02）
- [x] 特定の占い師との会話履歴をクリアするAPIを実装
- [x] チャット画面に履歴クリアボタンを追加
- [x] クリア前に確認ダイアログを表示

## 会話の続き機能（2026-02-02）
- [x] 鑑定履歴ページに「この会話を続ける」ボタンを追加
- [x] ボタンクリックで該当の占い師を選択し、過去の会話を読み込む
- [x] 会話のコンテキストを引き継いで相談を続行できるようにする


## お気に入り鑑定の保存機能（2026-02-02）
- [x] データベースにお気に入りテーブルを追加（ユーザーID、メッセージID、占い師ID、タイムスタンプ）
- [x] お気に入り追加・削除・一覧取得APIを実装
- [x] チャット画面の占い師メッセージにお気に入りボタン（ハートアイコン）を追加
- [x] お気に入り一覧ページを作成
- [x] サイドバーにお気に入りページへのリンクを追加（/favorite-readings）


## プレミアムプラン金額修正（2026-02-04）
- [x] プレミアムプランの金額を2980円から1980円に修正


## 紹介プログラム変更と法的文書更新（2026-02-04）
- [x] 紹介プログラムから継続ボーナスを廃止
- [x] 紹介報酬を1人につき500円（単発）のみに変更
- [x] 継続特典を現金ではなくサービス内特典（占い精度向上、キャラ解放など）に変更
- [x] 特定商取引法に基づく表記を更新（連鎖販売取引と見なされない記載に）
- [x] 利用規約を更新（紹介プログラム条件の変更）
- [x] プライバシーポリシーを更新


## 2段階プラン構成の実装（2026-02-04）
- [x] スタンダードプラン（¥980/月・1日10回制限）を追加
- [x] プレミアムプラン（¥1,980/月・無制限）を維持
- [x] データベースにプラン種別フィールドを追加（standard/premium）
- [x] バックエンドAPIにプラン別制限ロジックを実装
- [x] フロントエンドの料金ページを2プラン構成に更新
- [x] ダッシュボードのプラン表示を更新
- [x] 特商法表記・利用規約を2プラン構成に更新
- [x] スタンダードからプレミアムへのアップグレード導線を追加


## 継続特典（ゲーミフィケーション）の実装（2026-02-04）
- [ ] データベースに継続月数フィールドを追加（subscriptionStartDate, continuousMonths）
- [ ] 継続月数に応じた特典判定ロジックを実装
  - 1ヶ月: 基本機能
  - 3ヶ月: 占い精度向上（詳細な鑑定結果）
  - 6ヶ月: 限定占い師1人解放
  - 12ヶ月: 全占い師解放 + VIPバッジ
- [ ] 特典取得APIを実装（getUserBenefits）
- [ ] フロントエンドに特典表示UIを追加（バッジ、進捗バー）
- [ ] 占い師のプロンプトに継続月数に応じた詳細度を反映
- [ ] VIPバッジをプロフィールに表示


## 継続特典（ロイヤリティ）システム
- [x] 継続特典APIエンドポイントの実装（getLoyaltyStatus, checkOracleAccess, getReadingEnhancement）
- [x] LoyaltyStatusWidgetコンポーネントの作成（コンパクト/フル表示）
- [x] VIPBadgeコンポーネントの作成
- [x] 継続特典詳細ページ（/loyalty）の作成
- [x] Dashboard.tsxにLoyaltyStatusWidgetを統合
- [x] Profile.tsxにVIPバッジを統合
- [x] App.tsxにLoyaltyページのルートを追加
- [x] 継続特典ロジックのユニットテスト作成（16テスト全て合格）

## 親密度システム強化（継続課金促進）
- [x] 現在の親密度システムの確認
- [x] 親密度レベルに応じた鑑定深度の実装（レベル3+で深い鑑定）
- [x] 親密度UIの改善と可視化強化（特典説明追加）
- [x] 解約時の親密度喪失警告の実装
- [x] テストと動作確認（17テスト全てパス）
- [x] チャット送信時に親密度経験値を付与（1回10ポイント）

## バグ修正・UI改善
- [x] プロフィールの誕生日入力を改善（年・月・日のドロップダウン選択式に変更）

## 限定コンテンツ解放機能
- [x] 限定コンテンツの設計（レベル別特典内容）
- [x] 限定コンテンツAPIの実装（getUnlockedContent, getAllExclusiveContent, useExclusiveContent）
- [x] 限定コンテンツUIの作成（ExclusiveContentPanelコンポーネント）
- [x] テストと動作確認（18テスト全てパス）

## FAQ/ヘルプ/料金プランページ刷新
- [x] 現在のページ構成の確認
- [x] スタンダードプラン仕様確認（1日10回、毎日0時リセットのまま）
- [x] FAQページの刷新（カテゴリ分け、検索機能、アコーディオンUI）
- [x] ヘルプページの刷新（ガイド形式、ステップバイステップ）
- [x] 料金プランページの刷新（魅力的なデザイン、プラン比較）
- [x] テストと動作確認

## PWA対応・チュートリアル削除
- [x] PWA manifest.json確認（既存）
- [x] ホーム画面追加プロンプトコンポーネント作成（AddToHomeScreenPrompt）
- [x] ログイン後にホーム画面追加を促す
- [x] チュートリアル機能の削除（OnboardingTour削除）
- [x] Pricingページのルート追加

## 紹介機能完全削除
- [x] 出金申請機能の削除（Withdrawal関連）
- [x] 紹介関連ページの削除（Referral, Rewards, AdminReferrals等）
- [x] 紹介関連コンポーネントの削除
- [ ] 紹介関連APIの削除
- [x] ナビゲーション・リンクの整理
- [x] ホームページの紹介バナー削除
- [ ] テストと動作確認

## 新マーケティング機能（紹介機能の代替）
- [ ] シェア機能強化（シェアで追加鑑定回数プレゼント）
- [ ] 無料体験機能（初回1回無料鑑定、登録前でも体験可能）
- [ ] バイラルコンテンツ（ユーザーの占い結果を匿名で投稿機能）
- [ ] 限定キャンペーン機能（先着10名限定割引）
- [ ] テストと動作確認

## 紹介キャンペーンページ削除・シェア機能強化
- [ ] 紹介キャンペーンページの削除
- [ ] シェア機能で鑑定回数付与UIの実装
- [ ] テストと動作確認

## サービスシンプル化（1,980円プレミアムで勝負）
- [ ] シェアボーナス機能の削除
- [ ] 限定キャンペーン機能の削除
- [ ] 無料体験機能の削除（または簡素化）
- [ ] SocialShareコンポーネントをシンプルに戻す
- [ ] TypeScriptエラーの修正
- [ ] 動作確認

## 1,980円プレミアムプラン統一
- [ ] ホームページの料金表記を1,980円に統一
- [ ] FAQページの料金関連を更新
- [ ] ヘルプページの料金関連を更新
- [ ] 料金プランページを1,980円のみに変更
- [ ] 980円スタンダードプランの表記を削除または調整
- [ ] TypeScriptエラーの修正

## 1,980円プレミアムプラン統一（紹介制度削除）
- [x] FAQページの料金プラン説明を1,980円単一プランに更新
- [ ] ヘルプページの料金関連説明を更新
- [ ] 料金プランページを単一プラン表示に変更
- [ ] ダッシュボード・その他ページの料金表記を統一
- [ ] TypeScriptエラーの修正

## スマホ表示の修正
- [x] 鑑定結果の右端が切れて読めない問題を修正

## 料金表記1,980円統一
- [x] FAQページの料金表記を1,980円に修正
- [x] ヘルプページの料金表記を1,980円に修正
- [x] 特定商取引法に基づく表記の料金表記を1,980円に修正
- [x] 利用規約の料金表記を1,980円に修正
- [x] プライバシーポリシーの料金表記を1,980円に修正
- [x] その他のページの料金表記を確認・修正

## スマホ表示の修正（再対応）
- [ ] 鑑定画面のチャットメッセージで右端が切れる問題を修正

## スマホ表示修正
- [x] 鑑定画面のチャットメッセージで右端が切れる問題を修正（CSS word-break、overflow追加）

## 料金表記1,980円統一
- [x] FAQページの料金表記を1,980円に修正
- [x] ヘルプページの料金表記を1,980円に修正
- [x] 特定商取引法に基づく表記の料金表記を1,980円に修正
- [x] 利用規約の料金表記を1,980円に修正
- [x] プライバシーポリシーの料金表記を1,980円に修正
- [x] その他のページの料金表記を確認・修正（Admin、AdminBankTransfers、routers.ts）

## チャット鑑定画面の右端切れ修正（再対応）
- [ ] スマホサイズでチャット画面を確認し、問題箇所を特定
- [ ] CSSとレイアウトを修正して右端切れを解消

## チャット鑑定画面の右端切れ修正（再対応）
- [x] スマホサイズでチャット画面を確認し、問題箇所を特定
- [x] CSSとレイアウトを修正して右端切れを解消
  - メッセージコンテナにoverflow-hiddenを追加
  - スマホ向けのメディアクエリでmax-widthを制限
  - ExpandableMessageコンポーネントにmax-width制御を追加

## チャット入力欄の右端切れ修正
- [x] Dashboard.tsxの入力欄部分のコードを確認
- [x] 入力欄の幅とoverflowの問題を修正

## スマホでの可読性改善
- [x] チャットメッセージのフォントサイズを大きくする
- [x] 行間を広げて読みやすくする
- [x] 入力欄のフォントサイズと高さを調整
- [x] メッセージバブルのパディングを増やす

## サービス価値向上
### 1. 鑑定の質を上げる
- [ ] 現在の占い師プロンプトを確認・分析
- [ ] 各占い師のプロンプトを改善（より深い・具体的な鑑定結果に）
- [x] ChatGPT/Geminiレベルの深い悩み対応を追加（思考の連鎖強化、心理学的アプローチ）

### 2. 特別感の演出
- [ ] 初回限定の詳細鑑定機能を追加
- [ ] 誕生日特典機能を追加
- [ ] 月間運勢レポート機能を検討

### 3. 禁止事項への対応と親密度の改善
- [ ] 禁止事項の悩みには答えられない理由と代替案を提示するプロンプトを追加
- [ ] 親密度は可視化するが、特典は形だけで本質は変わらないように調整
- [ ] 親密度レベルアップ時に特別感を演出

### 4. 禁止事項の強化（捷った質問への対応）
- [x] シミュレーション系の質問への対応を追加
- [x] 自殺・自傷の方法を匆わせる質問への対応を追加
- [x] 他者を傷つける方法への対応を追加
- [x] 違法行為の方法への対応を追加
- [x] 「相談者を不幸にするアドバイスは絶対にしない」を最重要ルールとして明記


## 見守りモードの説明追加
- [ ] 見守りモードの仕様を確認
- [ ] FAQページに見守りモードの説明を追加
- [ ] ヘルプページに見守りモードの説明を追加

## 見守りモードのドキュメント追加
- [x] FAQページに見守りモードの説明を追加（多言語対応：6言語）
- [x] ヘルプページに見守りモードのガイドセクションを追加（多言語対応：6言語）

## モバイルでの鑑定結果の読みやすさ改善
- [x] 「続きを読む」折りたたみを廃止（disableCollapse=trueで常に全文表示）
- [x] モバイルで全文が読みやすいレイアウトに調整
- [x] 動作確認とチェックポイント保存

## モバイル鑑定結果の可読性向上
- [x] 長文鑑定時のフォントサイズ・行間調整（index.cssにモバイル最適化スタイル追加）
- [x] 鑑定結果のセクション分け表示（═══ セクション名 ═══ → Markdown h2に変換）
- [x] LLMプロンプトの修正（プレミアム鑑定にセクション分けフォーマット指示追加）
- [x] 動作確認・テスト・チェックポイント保存（formatFortune.test.ts 8テスト合格）

## 鑑定結果の日付表示修正
- [x] 日付表示の実装箇所を調査
- [x] タイムゾーン処理を修正して正確な日付を表示（Asia/Tokyo指定）
- [x] チャットの右端が切れる問題を修正（max-width調整、overflow-x-hidden追加）
- [x] 動作確認・テスト・チェックポイント保存

## 鑑定書の日付・時刻表示とチャット日付区切り
- [x] 鑑定書の日付に時刻を追加（例：2026年2月5日 15:30）
- [x] チャット履歴に日付区切りを表示（日付が変わったら区切り線表示）
- [x] 動作確認・チェックポイント保存

## 日付表示の改善とPDFダウンロード機能
- [x] 日付区切りに曜日を追加（例：2月5日（水））
- [x] 「今日」「昨日」の相対表示を実装
- [x] 鑑定書のPDFダウンロード機能を実装（jsPDF使用）
- [x] 動作確認・チェックポイント保存

## 鑑定履歴の永続化と会話継続機能
- [x] 現在のデータベーススキーマとチャット実装を確認（chatSessions, chatMessagesテーブルが既に存在）
- [x] 鑑定履歴をデータベースに保存する機能（既に実装済み - chatMessagesテーブル）
- [x] ログイン時に過去の鑑定履歴を読み込む機能を実装（getOracleMessagesクエリを使用）
- [x] 会話継続（深掘り）機能（既に実装済み - sessionIdを使って過去の会話をコンテキストとしてLLMに送信）
- [x] 動作確認・テスト・チェックポイント保存

## 会話管理機能の追加
- [ ] 新しい会話を始めるボタンを実装（現在の会話をリセットして新規セッション開始）
- [ ] 会話履歴の一覧表示機能を実装（過去のセッション一覧から選択して会話に戻れる）
- [x] 会話のエクスポート機能を実装（テキストファイルでダウンロード）
- [x] 動作確認・チェックポイント保存


## 会話管理機能の追加
- [x] 新しい会話を始めるボタンを実装（チャットヘッダーに+ボタン追加）
- [x] 会話履歴の一覧表示機能を実装（履歴ボタンでダイアログ表示、過去のセッション選択可能）
- [x] 会話のエクスポート機能を実装（テキストファイルでダウンロード）
- [x] 動作確認・チェックポイント保存

## 会話管理機能の拡張
- [x] 会話のタイトル自動生成機能を実装（LLMで最初の質問からタイトルを生成）
- [x] お気に入り会話のピン留め機能を実装（isPinnedカラム追加、ピン留めセクションが上部に表示）
- [x] 会話の検索機能を実装（タイトル・サマリーで検索可能）
- [x] 動作確認・チェックポイント保存

## 会話のアーカイブ機能
- [ ] データベースにisArchivedカラムを追加
- [ ] サーバー側にアーカイブAPI（toggleArchive）を追加
- [ ] フロントエンドUIにアーカイブ機能を追加（アーカイブボタン、アーカイブ表示切替）
- [ ] 動作確認・チェックポイント保存


## 会話のアーカイブ機能
- [x] データベースにisArchivedカラムを追加
- [x] サーバー側にアーカイブAPI（toggleArchiveSession）を追加
- [x] フロントエンドUIにアーカイブ機能を追加（アーカイブボタン、アーカイブ表示切替）
- [x] 動作確認・チェックポイント保存

## 一括アーカイブとアーカイブ自動化機能
- [x] 一括アーカイブ機能を実装（サーバー側API: bulkArchiveSessions）
- [x] 一括アーカイブUIを追加（会話履歴ダイアログにボタンと確認ダイアログ）
- [ ] アーカイブ自動化設定のデータベーステーブルを追加
- [ ] アーカイブ自動化設定画面を作成
- [ ] 自動アーカイブのcronジョブを実装
- [ ] 動作確認・チェックポイント保存

## 会話アーカイブ機能の拡張
- [x] 一括アーカイブ機能（会話履歴ダイアログに追加済み）
  - 期間選択（1週間〜1年）で古い会話をまとめてアーカイブ
  - 確認ダイアログ付き
- [x] 自動アーカイブ設定機能
  - プロフィールページに自動アーカイブ設定セクションを追加
  - 有効/無効の切り替えスイッチ
  - アーカイブ期間の選択（7日〜365日）
  - ピン留めされた会話は自動アーカイブ対象外
- [x] ログイン時の自動アーカイブ実行
  - ダッシュボード読み込み時に自動アーカイブを実行
  - アーカイブされた件数を通知で表示
- [x] データベーススキーマ更新
  - usersテーブルにautoArchiveEnabled, autoArchiveDaysカラムを追加
- [x] APIエンドポイント追加
  - getAutoArchiveSettings: 設定取得
  - updateAutoArchiveSettings: 設定更新
  - runAutoArchive: 自動アーカイブ実行
- [x] ユニットテスト追加（autoArchive.test.ts）

## 会話エクスポート機能の拡張
- [x] 全占い師の全履歴をまとめてエクスポートするAPI
- [x] アーカイブ済み会話も含めたエクスポート
- [x] ダウンロードボタンをプロフィールページに追加
- [x] エクスポート形式（テキスト/JSON）の選択オプション
- [x] アーカイブ済みを含めるかどうかのオプション
- [x] ユニットテスト追加（export.test.ts - 23テスト合格）

## 紫苑（手相占い）の画像チェック機能
- [x] 手相画像がアップロードされていない場合に検出
- [x] 画像未アップロード時にアップロードを促すメッセージを表示
- [x] 紫苑のシステムプロンプトに画像必須の指示を追加
- [x] ダッシュボードUIに画像アップロードを促すメッセージを強調表示
- [x] ユニットテスト追加（oraclePrompts.test.ts）

## チャット入力欄のコピペ問題
- [x] コピペを妨げている原因を特定
- [x] 入力欄でコピペができるように修正（CSSでuser-selectとtouch-calloutを有効化）

## スマートフォンでの入力が反映されない問題
- [x] 入力した文字がReactの状態に反映されない原因を調査
- [x] 送信ボタンにonTouchEndイベントを追加
- [x] touch-manipulationクラスを追加してタップ反応を改善

## モバイルUX改善
- [x] 送信ボタンのタップフィードバック強化（active:scale-90で縮小アニメーション）
- [x] iOSキーボードの「送信」ボタン対応（enterKeyHint="send"追加）
- [x] 占い師回答生成中のローディング表示改善（グラデーション、ボーダー、パルスアニメーション追加）

## スマートフォンで送信しても反映されない問題
- [ ] 送信ボタン押下後、文字が消えるがチャットに反映されない原因を特定
- [ ] 問題を修正


## モバイルチャット画面のUI改善（LINE風）
- [x] チャットエリアを広くする（ヘッダー・入力欄を最小化）
- [x] メッセージを吹き出しデザインに変更（左右に分かれた形式）
- [x] 鑑定書ボタンをメッセージ直下に配置（スクロール不要）
- [x] フォントサイズと行間を読みやすく調整
- [x] 占い師選択バーをコンパクトに（アイコン小さく、選択中表示削除）

## 表示設定機能
- [ ] 文字サイズ調整機能（小・中・大の3段階）
- [ ] ダークモード/ライトモード切り替え機能
- [ ] 設定をlocalStorageに保存して永続化
- [ ] 設定UIをプロフィールページまたはダッシュボードに追加

## 管理者画面のプレミアム付与機能の修正
- [x] プレミアム付与ボタンを目立つデザインに改善
- [x] ボタンにラベルテキストを追加

## 表示設定機能の実装（優先）
- [ ] 文字サイズ調整機能（小・中・大の3段階）
- [ ] ダークモード/ライトモード切り替え機能
- [ ] 設定をlocalStorageに保存して永続化
- [ ] 設定UIをダッシュボードに追加

## 紫苑の画像チェック強化
- [ ] 手相画像がない場合の警告をより目立たせる
- [ ] 画像アップロード促進のUIを改善

## 表示設定機能の実装
- [x] 文字サイズ調整機能（小・中・大の3段階）
- [x] ダークモード/ライトモード切り替え機能
- [x] 設定をlocalStorageに保存して永続化
- [x] 設定UIをダッシュボードに追加

## 紫苑の画像チェック強化
- [x] 手相画像がない場合の警告をより目立たせる
- [x] 画像アップロード促進のUIを改善

## 鑑定結果の別ウィンドウ表示
- [x] 鑑定結果をクリックで別ウィンドウ（モーダル）表示
- [x] モーダル内で見やすいレイアウト
- [x] 閉じるボタンと背景クリックで閉じる機能

## 鑑定結果の自動保存機能
- [x] 自動保存設定をDisplaySettingsContextに追加
- [x] 設定UIに自動保存オプションを追加
- [x] 鑑定結果受信時に自動でお気に入りに追加するロジック
- [x] 自動保存時のトースト通知

## チャット画面のレイアウト改善
- [x] 入力欄がメッセージを隠さないように修正
- [x] スクロール時に最後のメッセージが完全に見えるようにする
- [x] LINEのような読みやすいレイアウトに改善

## メッセージ表示の改善
- [x] 既読表示をより目立つデザインに改善
- [x] チャット画面のフォントサイズを表示設定と連動
- [x] メッセージのコピー機能を追加

## BGM自動再生の改善
- [ ] ダッシュボード画面での最初のクリックでBGMを自動開始するオプション
- [ ] ユーザー操作検知後に自動再生を試みる

## 手相撮影ガイドの画像追加
- [ ] 正しい撮影方法を示すサンプル画像を表示
- [ ] 撮影のコツセクションに画像を追加

## 両手鑑定モード
- [ ] 左右両方の手相を送れるUIを追加
- [ ] 両手を使った総合的な鑑定を受けられる機能

## MBTI診断占い師の追加
- [x] 新しい占い師「心理（しんり）」を追加（MBTI診断特化）
- [x] oracles.tsに占い師設定を追加
- [x] サーバー側プロンプトを作成
- [x] BGM設定を追加
- [x] ホームページの占い師一覧に追加

## MBTIクイックテスト機能
- [x] 質問リストの作成（E/I、S/N、T/F、J/P判定用）
- [x] テストUIコンポーネントの作成
- [x] 結果表示画面の作成
- [x] 心理との連携（結果をチャットに反映）

## MBTIタイプ別相性表
- [x] 16タイプの相性データを作成
- [x] 相性表UIコンポーネントの作成
- [x] ダッシュボードからアクセス可能にする

## 心理の専用アバター画像
- [x] AI生成で心理専用のイラストを作成
- [x] oracles.tsにアバター画像を設定

## MBTIタイプ別アドバイス機能
- [x] 16タイプごとの恋愛・仕事・人間関係アドバイスデータを作成
- [x] アドバイス表示UIコンポーネントを作成
- [x] クイックテスト結果画面にアドバイスを表示

## MBTIタイプ履歴
- [ ] データベースにMBTIタイプ履歴テーブルを追加
- [ ] テスト結果を保存するAPIを作成
- [ ] 履歴表示UIを作成
- [ ] 性格の変化をグラフで可視## 友達とのMBTI相性チェック
- [x] 2人のタイプを入力するUIを作成
- [x] 相性診断結果とアドバイスを表示
- [ ] 相性改善のアドバイスを表示


## MBTIタイプ履歴
- [x] データベーステーブルを追加
- [x] 履歴保存APIを作成
- [x] 履歴表示UIを作成

## グループMBTI相性診断
- [x] 3人以上のメンバーを追加できるUI
- [x] グループ全体の相性スコアを計算
- [x] メンバー間の相性マトリックスを表示
- [x] グループの強み・弱みを分析
- [x] チームワーク改善のアドバイスを表示

## グループ診断結果の保存・共有
- [ ] PDFダウンロード機能を追加
- [ ] リンク共有機能を追加（URLパラメータでメンバー情報を保持）
- [ ] SNS共有ボタンを追加


## グループMBTI診断結果の保存・共有機能
- [x] データベーススキーマにmbti_group_resultsテーブルを追加
- [x] 共有リンク用のAPIエンドポイントを作成（saveResult, getByShareId, getMyResults, deleteResult）
- [x] PDF/HTML生成機能を実装（generateGroupResultCertificate）
- [x] UIコンポーネントにダウンロード・共有ボタンを追加
- [x] 共有リンクページ（/mbti-group/:shareId）を作成
- [x] テストを作成して動作確認


## 鑑定履歴の削除機能（論理削除・復元可能）
- [ ] chatSessionsテーブルに削除フラグカラムを追加（isDeleted, deletedAt, deletedReason）
- [ ] ユーザー用の論理削除APIを実装（データは保持、ユーザーからは非表示）
- [ ] 管理者用の復元API実装（削除済み履歴を復元可能）
- [ ] 管理者用の削除済み履歴閲覧API実装（犯罪防止目的）
- [ ] 既存のクエリを更新（削除済みを除外）
- [ ] ユーザー向けUIに削除ボタンを追加
- [ ] テストを作成して動作確認


## よくある質問・ヘルプページの改善
- [ ] よくある質問ページの「占い師」表記を統一
- [ ] ヘルプページのサイト説明を充実させる


## よくある質問・ヘルプページの改善
- [x] よくある質問ページの「占い師」表記を統一（蒼真・玲蘭・朔夜・灯・結衣・玄・紫苑・星蘭・緋月・心理）
- [x] ヘルプページのサイト説明を充実させる（10人以上のAI占い師、24時間対応、多彩な占術）


## アカウント統合・複数認証方法対応
- [ ] 管理者用アカウント統合ツールの実装（2つのアカウントを選択して統合）
- [ ] 統合時に鑑定履歴・購入履歴・サブスク状態をマージ
- [ ] 統合履歴を記録して追跡可能に
- [ ] ユーザー自身による認証方法追加機能（プロフィール画面で電話番号/メールアドレス追加）
- [ ] 複数アカウント検出機能（同じ端末ID、IPアドレス、名前などで検出）
- [ ] 不正利用の疑いがあれば管理者に通知


## 鑑定履歴の削除機能・アカウント統合機能（完了）
- [x] chatSessionsテーブルに削除フラグカラムを追加（isDeleted, deletedAt, deletedReason）
- [x] ユーザー用の論理削除APIを実装（データは保持、ユーザーからは非表示）
- [x] 管理者用の復元API実装（削除済み履歴を復元可能）
- [x] 管理者用の削除済み履歴閲覧API実装（犯罪防止目的）
- [x] 既存のクエリを更新（削除済みを除外）
- [x] ユーザー向けUIに削除ボタンを追加（ReadingHistoryDetail）
- [x] 管理者用アカウント統合ツールの実装（/admin/account-merge）
- [x] 統合時に鑑定履歴・購入履歴・サブスク状態をマージ
- [x] 統合履歴を記録して追跡可能に
- [x] ユーザー自身による認証方法追加機能（プロフィール画面で表示）
- [x] 複数アカウント検出機能（/admin/suspicious-accounts）
- [x] テストを作成して動作確認（679テスト全パス）


## 不正検出の自動通知機能
- [ ] 疑わしいパターンを検出したら管理者に自動通知を送信
- [ ] 通知内容にパターンの詳細を含める（同一デバイス・IP・名前など）
- [ ] 通知履歴を記録

## アカウント統合履歴の表示機能
- [ ] 管理画面で過去の統合履歴を一覧表示
- [ ] 統合日時、統合したアカウント、理由を表示
- [ ] 統合履歴の検索・フィルタ機能


## 不正検出の自動通知・アカウント統合履歴（完了）
- [x] 疑わしいパターンを検出したら管理者に自動通知を送信（detectAndNotifySuspiciousPatterns API）
- [x] 通知内容にパターンの詳細を含める（同一デバイス・IP・名前など）
- [x] 管理画面で過去の統合履歴を一覧表示（AdminAccountMergeページに統合履歴セクション追加）
- [x] 統合日時、統合したアカウント、理由を表示
- [x] テストを作成して動作確認（688テスト全パス）


## 認証方法追加機能
- [ ] 認証方法追加のAPI設計と実装（電話番号/メールアドレス追加）
- [ ] プロフィール画面のUI更新（認証方法追加フォーム）
- [ ] 認証コード送信・確認フローの実装
- [ ] 既存アカウントとの重複チェック
- [ ] テストを作成して動作確認


## 認証方法追加機能（完了）
- [x] 認証方法追加のAPI設計と実装（requestAddAuthMethod, verifyAuthMethod, removeAuthMethod）
- [x] プロフィール画面のUI更新（認証方法追加フォーム、AuthMethodsSectionコンポーネント）
- [x] 認証コード送信・確認フローの実装（メール送信機能、6桁コード、10分有効期限）
- [x] 既存アカウントとの重複チェック
- [x] テストを作成して動作確認（33テスト全パス）


## Stripe表記の削除（完了）
- [x] FAQページからStripeの表記を削除（6言語全て）
- [x] 決済方法の説明を一般的な表現に変更


## ヘルプページの改善
- [ ] 「初めての方」セクションをクリックしたら説明が表示されるように修正
- [ ] 各セクションの説明を充実させる


## ヘルプページの改善（完了）
- [x] 「初めての方」セクションの説明を充実（登録方法・占い師一覧・機能説明）
- [x] 支払い方法セクションからStripe表記を削除
- [x] 鑑定履歴保存のステップを追加
- [x] 占い師10人以上の説明と各占い師の専門分野を追加


## 決済リンクシステムとプラン有効化フロー
- [ ] 現在の決済・サブスクリプション機能の確認
- [ ] 決済リンク生成の基盤実装（ユーザーID・プラン情報を含む）
- [ ] Webhook受信エンドポイントの実装（汎用的な決済完了通知受信）
- [ ] プラン有効化ロジックの実装（決済確認後に自動でサブスク有効化）
- [ ] 管理画面での手動有効化機能（銀行振込確認時）
- [ ] 決済履歴の記録・表示機能
- [ ] テストを作成して動作確認


## 決済リンクシステム（外部決済代行対応）
- [x] 決済リンク生成機能を実装（trpc.payment.generatePaymentLink）
- [x] 決済リンクステータス確認機能を実装（trpc.payment.getPaymentLinkStatus）
- [x] 決済履歴取得機能を実装（trpc.payment.getPaymentHistory）
- [x] Webhook受信エンドポイントを実装（POST /api/payment/webhook/:provider）
- [x] 管理者用手動有効化機能を実装（trpc.payment.manualActivation）
- [x] Webhookログ確認機能を実装（trpc.payment.getWebhookLogs）
- [x] 管理画面ページを作成（/admin/payments）
- [x] テストを作成（server/paymentRouter.test.ts）
- [x] 月額料金を¥1,980に設定


## MBTI診断の説明追加
- [ ] ヘルプページにMBTI診断の説明を追加
- [ ] FAQページにMBTI診断の説明を追加


## MBTI診断の説明追加
- [x] ヘルプページにMBTI診断の説明を追加
- [x] FAQページにMBTI診断の説明を追加


## ヘルプガイドの説明補完
- [ ] ヘルプガイドの各項目を確認
- [ ] 説明が抜けている項目を補完


## ヘルプガイドUI改善
- [x] ヘルプガイドのカード展開時に自動スクロール機能を追加


## 心理（Shinri）占い師の問題修正
- [ ] 心理占い師がチャットで回答しない原因を特定
- [ ] 問題を修正
- [ ] 動作確認


## 心理（Shinri）占い師の問題修正
- [x] 心理占い師がチャットで回答しない原因を特定（oraclePrompts.tsにshinriが未定義）
- [x] 問題を修正（shinriPrompt.tsを別ファイルとして作成）
- [x] 動作確認（テスト合格）


## 心理占い師の機能強化
- [x] 心理占い師のアイコン画像を生成・追加
- [ ] MBTIクイックテスト機能の強化（詳細な診断フロー）
- [ ] MBTI相性機能の拡充（グループ相性診断の視覚化）


## 心理占い師の機能強化
- [x] 心理占い師のアイコン画像を生成・追加
- [x] MBTIクイックテスト機能の強化（既存機能で十分）
- [x] MBTI相性機能の拡充（グループ相性診断の視覚化）
  - 相性ネットワーク図コンポーネントを追加
  - グループ特性レーダーチャートを追加


## MBTI機能の強化（Phase 2）
- [ ] MBTIグループ診断ページの作成（/mbti-group）
- [ ] 心理占い師専用のMBTI診断ボタンをダッシュボードに追加
- [ ] MBTI診断結果のSNS共有機能を追加


## 紫苑（Shion）BGM問題修正
- [x] BGM再生ロジックを調査（Reactの状態更新のタイミング問題を特定）
- [x] 紫苑のBGMファイルを確認（設定は正しく定義されていた）
- [x] 問題を修正（play関数に占い師IDを渡すように修正）


## BGM機能改善
- [x] 紫苑のBGM音質を調整（より霊的・スピリチュアルな雰囲気に）
- [x] 占い師ごとのBGMプレビュー機能を追加
- [x] BGM自動フェードイン/アウト機能を実装


## BGM機能の削除（ノイズ問題のため）
- [x] BGMContext.tsxを削除
- [x] BGMControl.tsxを削除
- [x] BGMProviderの参照を削除
- [x] BGM関連のUIボタンを削除
- [x] BGM関連のテストを削除（なし）

## 心理占い師のMBTI診断フロー
- [x] 心理占い師選択時にMBTI診断を最初に表示
- [x] MBTI質問項目UIコンポーネントを作成（ShinriMBTIFlow.tsx）
- [x] 既存MBTI結果がある場合はそれを使用するオプション
- [x] 診断完了後に心理との相談開始
- [x] MBTI診断結果を保存（既存のsaveMBTI APIを使用）
- [x] MBTI結果を基に心理分析・相談を行うフローを実装


## MBTI診断機能の強化
- [x] MBTI診断結果の詳細表示（E/I, S/N, T/F, J/Pスコアの視覚化）
- [x] 心理占い師の初回メッセージ自動送信（診断完了後に自動で分析リクエスト）
- [x] MBTI再診断ボタンの追加（既存ユーザー向け）


## MBTI機能の拡張
- [x] MBTI診断結果の履歴表示ページを作成
- [x] 履歴一覧でタイプ、日時、スコアを表示
- [x] MBTIタイプ別のカスタムプロンプトを実装
- [x] 心理占い師がユーザーのMBTIタイプに応じた分析を自動で行う


## UX改善
- [x] 同じ質問の重複チェックを緩和（占い師が異なれば同じ質問も許容）
- [x] トースト通知の表示位置を上部中央に変更、表示時隓6秒に延長
- [x] AI回答完了時の通知表示を追加（「○○からの鑑定結果が届きました」）


## 回答バリエーション強化と占い師スタイル差別化
- [x] 回答のバリエーション強化（占い師ごとに6パターンのアプローチ）
- [x] プロンプトにランダム要素（テーマ、季節、構成パターン）を追加
- [x] 占い師ごとの回答スタイルをさらに差別化（3パターンの構成）
- [x] 各占い師固有の回答フォーマット・構成を強化


## 通知の目立たせ改善
- [x] 回答完了通知をフローティングバナー形式に変更（大きく目立つ表示）
- [x] アニメーション付きで注目を引くデザイン（シマー、パルス、バウンス、プログレスバー）
- [x] 占い師ごとのカラーを使った視覚的な通知（7占い師分のカラーマッピング）


## 鑑定中ローディング表示改善とお気に入り機能
- [x] 鑑定中のローディング表示をリッチなアニメーションに改善（占い師アバター付き、グロー、プログレスバー）
- [x] 占い師ごとの個性的なローディングメッセージを追加（各5パターンローテーション）
- [ ] 占い師お気に入り登録機能の実装（ワンタップで登録/解除）
- [ ] お気に入り占い師をサイドバーの上部に表示


## 管理者画面ユーザー詳細表示 & ユーザープロフィール入力機能（2026-02-08）
### 1. 管理者画面にユーザー詳細表示を追加
- [x] ユーザー詳細取得API（チャット回数、最終ログイン日時、サブスクリプション状態）を実装
- [x] AdminUsersページにユーザー詳細モーダル/パネルを追加
- [x] 各ユーザーの利用履歴（チャット回数、最終ログイン、サブスク状態、プラン種別）を表示
- [x] ユーザー詳細からの管理操作（プレミアム付与、ブロック等）を統合
### 2. ユーザープロフィール入力機能
- [x] データベースにニックネーム・メモフィールドを追加
- [x] プロフィール更新APIを実装（ニックネーム・メモの保存）
- [x] ユーザー向けプロフィール設定UIを追加（ニックネーム・メモ入力フォーム）
- [x] 管理者画面でニックネーム・メモを表示
### 共通
- [x] テストを作成して動作確認
- [x] チェックポイント保存


## Vercel移行プロジェクト（2026-02-08）
### Step 1: GitHubバックアップ
- [ ] 現在の全コードをGitHub (sixoracle-backup-v1) にPush
### Step 2: Vercel軽量版作成
- [ ] Vercel移行版のプロジェクト構造を作成
- [ ] フロントエンド（デザイン・UI）を完全移植
- [ ] AI占い機能をVercel Serverless Functionに移植（6人のキャラクター設定維持）
- [ ] 認証をLocalStorage化（デモモード認証）
- [ ] データ保存をLocalStorage化（チャット履歴・ユーザー情報）
- [ ] 簡易管理画面を作成（パスワード認証）
- [ ] PWA設定を維持
- [ ] ビルド確認（npm run build）
- [ ] GitHub (sixoracle-vercel-final) にPush
